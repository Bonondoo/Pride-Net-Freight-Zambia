<!DOCTYPE html>
<html lang="en" class="theme-dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teachers Tool - Enhanced Educational Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #006600;
            --primary-light: #338833;
            --secondary: #ce1126;
            --accent: #1e293b;
            --light: #f0f8f0;
            --dark: #121212;
            --card-bg: #ffffff;
            --card-bg-dark: #252a3e;
            --sidebar-bg: #e6f0e6;
            --sidebar-bg-dark: #1f2537;
            --success: #28a745;
            --info: #17a2b8;
            --warning: #ffc107;
            --danger: #dc3545;
            --purple: #6f42c1;
            --pink: #e83e8c;
            --teal: #20c997;
            --gold: #ffd700;
            --header-height: 80px;
            --transition: all 0.3s ease;
            --border-radius: 12px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .theme-dark {
            --light: #121212;
            --card-bg: var(--card-bg-dark);
            --sidebar-bg: var(--sidebar-bg-dark);
            --accent: #e0e0e0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: var(--transition);
        }

        body {
            background-color: var(--light);
            color: var(--accent);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background-image: linear-gradient(135deg, var(--light) 0%, var(--sidebar-bg) 100%);
        }

        /* Login/Register Page Styles */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            padding: 20px;
        }

        .auth-card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 2.5rem;
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 450px;
            text-align: center;
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .auth-logo {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .auth-icon {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
        }

        .auth-icon span {
            color: white;
            font-weight: 800;
            font-size: 2.2rem;
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
        }

        .auth-text {
            font-weight: 800;
            font-size: 2rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }

        .auth-form .form-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .auth-form label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .auth-form input {
            width: 100%;
            padding: 0.9rem 1.2rem;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--border-radius);
            font-size: 1rem;
            background: var(--light);
            color: var(--accent);
        }

        .auth-form input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 102, 0, 0.1);
        }

        .auth-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: var(--border-radius);
            font-size: 1.1rem;
            font-weight: 600;
            width: 100%;
            cursor: pointer;
            transition: var(--transition);
        }

        .auth-btn:hover {
            background-color: #004d00;
            transform: translateY(-3px);
            box-shadow: 0 5px 12px rgba(0, 102, 0, 0.3);
        }

        .auth-footer {
            margin-top: 1.5rem;
            color: var(--accent);
            font-size: 0.9rem;
        }

        .auth-switch {
            margin-top: 1rem;
            color: var(--accent);
            cursor: pointer;
            font-weight: 600;
            text-decoration: underline;
        }

        .auth-switch:hover {
            color: var(--primary);
        }

        /* Header Styles */
        header {
            background-color: var(--card-bg);
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            height: var(--header-height);
            border-bottom: 3px solid var(--primary);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            width: 60px;
            height: 60px;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }

        .logo-icon span {
            color: white;
            font-weight: 800;
            font-size: 1.8rem;
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
        }

        .logo-text {
            font-weight: 800;
            font-size: 1.8rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }

        /* Navigation */
        nav ul {
            display: flex;
            list-style: none;
            gap: 12px;
        }

        nav ul li a {
            color: var(--accent);
            text-decoration: none;
            padding: 0.8rem 1.2rem;
            border-radius: var(--border-radius);
            transition: var(--transition);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(0, 102, 0, 0.05);
            border: 2px solid transparent;
        }

        nav ul li a:hover, nav ul li a.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 102, 0, 0.2);
        }

        /* Teacher Profile */
        .teacher-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 8px 15px;
            border-radius: var(--border-radius);
            background: rgba(0, 102, 0, 0.05);
            transition: var(--transition);
        }

        .teacher-profile:hover {
            background: rgba(0, 102, 0, 0.1);
        }

        .teacher-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
            border: 2px solid var(--card-bg);
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
            overflow: hidden;
            background-size: cover;
            background-position: center;
        }

        .teacher-info {
            text-align: right;
        }

        .teacher-info .name {
            font-weight: bold;
            color: var(--primary);
        }

        .teacher-info .role {
            font-size: 0.85rem;
            color: var(--accent);
        }

        /* Theme Toggle */
        .theme-toggle {
            background: var(--primary-light);
            border: none;
            width: 50px;
            height: 26px;
            border-radius: 13px;
            position: relative;
            cursor: pointer;
            display: flex;
            align-items: center;
            padding: 0 3px;
        }
        
        .theme-toggle::before {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            transition: transform 0.3s ease;
        }
        
        .theme-dark .theme-toggle::before {
            transform: translateX(24px);
        }

        /* Main Container */
        .container {
            display: grid;
            grid-template-columns: 280px 1fr;
            flex: 1;
            max-width: 1600px;
            margin: 0 auto;
            width: 100%;
        }

        /* Sidebar */
        .sidebar {
            background-color: var(--sidebar-bg);
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 25px;
            position: sticky;
            top: var(--header-height);
            z-index: 99;
            height: calc(100vh - var(--header-height));
            overflow-y: auto;
            border-right: 1px solid rgba(0, 102, 0, 0.2);
        }

        .sidebar h2 {
            color: var(--accent);
            margin-bottom: 1rem;
            font-size: 1.1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sidebar-menu {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .sidebar-menu button {
            background-color: transparent;
            border: none;
            padding: 0.9rem 1.2rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            text-align: left;
            transition: var(--transition);
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--accent);
            font-weight: 500;
        }

        .sidebar-menu button:hover, .sidebar-menu button.active {
            background-color: var(--primary);
            color: white;
            transform: translateX(5px);
        }

        /* Main Content */
        .main-content {
            padding: 2rem;
            background-color: var(--light);
            overflow-y: auto;
        }

        .dashboard-section {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .dashboard-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-header {
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--primary);
        }

        .section-header h2 {
            font-size: 1.8rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-header p {
            color: var(--accent);
            margin-top: 0.5rem;
            max-width: 800px;
        }

        /* Card Styles */
        .card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 1.8rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            margin-bottom: 1.5rem;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.12);
        }

        .card h3 {
            color: var(--primary);
            margin-bottom: 1.2rem;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            padding-bottom: 0.8rem;
        }

        .card-content {
            flex: 1;
        }

        .card p {
            color: var(--accent);
            font-size: 0.95rem;
            line-height: 1.7;
        }

        .card ul {
            padding-left: 1.5rem;
            margin-top: 1rem;
        }

        .card li {
            margin-bottom: 0.8rem;
            color: var(--accent);
            position: relative;
            padding-left: 25px;
        }

        .card li i {
            position: absolute;
            left: 0;
            top: 5px;
            color: var(--primary);
        }

        .card li.unread {
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .card-footer {
            margin-top: auto;
            padding-top: 1.2rem;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
        }

        /* Progress bar */
        .progress-container {
            background: rgba(0,0,0,0.1);
            border-radius: 10px;
            overflow: hidden;
            height: 10px;
            margin: 0.5rem 0 1rem;
        }
        
        .progress-bar {
            height: 100%;
            background: var(--primary);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        /* Grid Layouts */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
            margin-top: 1.5rem;
        }

        .grid-2col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        .grid-3col {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 0.9rem 1.7rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: var(--transition);
            border: none;
            text-decoration: none;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: #004d00;
            transform: translateY(-3px);
            box-shadow: 0 5px 12px rgba(0, 102, 0, 0.3);
        }

        .btn-secondary {
            background-color: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background-color: #a00d1e;
            transform: translateY(-3px);
            box-shadow: 0 5px 12px rgba(206, 17, 38, 0.3);
        }

        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background-color: var(--primary);
            color: white;
        }

        .btn-warning {
            background-color: var(--warning);
            color: #333;
        }

        .btn-warning:hover {
            background-color: #e67300;
            color: white;
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-info {
            background-color: var(--info);
            color: white;
        }

        .btn-purple {
            background-color: var(--purple);
            color: white;
        }

        .btn-gold {
            background-color: var(--gold);
            color: #333;
        }
        
        .btn-edit {
            background-color: var(--info);
            color: white;
        }

        /* Lesson Planner Section */
        .lesson-planner-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 1.5rem;
        }

        .lesson-form {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 1.8rem;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.6rem;
            font-weight: 600;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-control {
            width: 100%;
            padding: 0.9rem 1.2rem;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--border-radius);
            font-size: 1rem;
            background: var(--light);
            color: var(--accent);
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 102, 0, 0.1);
        }

        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }

        .subject-topics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 10px;
        }

        .topic-card {
            background-color: var(--light);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            font-weight: 500;
        }

        .topic-card:hover, .topic-card.active {
            background-color: rgba(0, 102, 0, 0.1);
            border-color: var(--primary);
            transform: translateY(-3px);
        }

        .topic-card.active {
            background-color: rgba(0, 102, 0, 0.2);
            border: 2px solid var(--primary);
        }

        .lesson-preview {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 1.8rem;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 0, 0, 0.05);
            max-height: 600px;
            overflow-y: auto;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .lesson-content {
            padding: 20px;
            background: var(--light);
            border-radius: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            flex: 1;
        }

        .lesson-header {
            text-align: center;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .lesson-header h3 {
            color: var(--primary);
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .lesson-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px dashed rgba(0, 0, 0, 0.1);
        }

        .lesson-section h4 {
            color: var(--secondary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .lesson-section ul {
            padding-left: 20px;
        }

        .lesson-section li {
            margin-bottom: 8px;
        }

        .lesson-download {
            position: sticky;
            bottom: 0;
            background: var(--card-bg);
            padding: 15px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* Attendance Section */
        .attendance-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 1.5rem;
        }

        .attendance-card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 1.8rem;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .attendance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .attendance-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .student-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .student-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .student-item:last-child {
            border-bottom: none;
        }

        .attendance-toggle {
            display: flex;
            gap: 10px;
        }

        .toggle-btn {
            padding: 0.6rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            border: 1px solid rgba(0, 0, 0, 0.1);
            background-color: transparent;
            min-width: 80px;
        }

        .toggle-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .toggle-btn.absent {
            background-color: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }

        .toggle-btn.late {
            background-color: var(--warning);
            color: #333;
            border-color: var(--warning);
        }

        /* Gradebook Section */
        .gradebook-container {
            margin-top: 1.5rem;
        }

        .grade-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            background: var(--card-bg);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        
        .grade-table th, .grade-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .grade-table th {
            background-color: var(--primary);
            color: white;
            font-weight: 600;
        }
        
        .grade-table tr:nth-child(even) {
            background-color: rgba(0, 0, 0, 0.03);
        }
        
        .grade-table tr:hover {
            background-color: rgba(0, 102, 0, 0.05);
        }
        
        .grade-table input {
            width: 70px;
            padding: 0.6rem;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            text-align: center;
            background: var(--light);
            color: var(--accent);
        }
        
        .grade-table .student-name {
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .student-name-container {
            flex-grow: 1;
        }
        
        .student-download {
            margin-left: 10px;
        }

        .grade-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 1.5rem;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--success);
            color: white;
            padding: 15px 25px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            max-width: 350px;
        }
        
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .toast.error {
            background-color: var(--danger);
        }
        
        .toast.warning {
            background-color: var(--warning);
            color: #333;
        }

        /* Footer */
        footer {
            background-color: var(--accent);
            color: white;
            text-align: center;
            padding: 1.8rem;
            border-top: 3px solid var(--primary);
        }

        footer p {
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 2rem;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            color: var(--primary);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--accent);
        }

        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-top: 1rem;
        }

        .schedule-item {
            background-color: var(--light);
            padding: 10px;
            border-radius: 8px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }

        .schedule-item:hover {
            background-color: rgba(0, 102, 0, 0.1);
            border-color: var(--primary);
        }

        .schedule-item.selected {
            background-color: rgba(0, 102, 0, 0.2);
            border: 2px solid var(--primary);
        }

        /* Profile editor */
        .profile-editor {
            display: grid;
            grid-template-columns: 150px 1fr;
            gap: 20px;
            margin-top: 1rem;
        }

        .profile-preview {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 2.5rem;
            border: 3px solid var(--card-bg);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
            background-size: cover;
            background-position: center;
        }

        .profile-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* Test Preview Styles */
        .test-content {
            padding: 20px;
            background: var(--light);
            border-radius: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            flex: 1;
        }

        .test-header {
            text-align: center;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .test-header h3 {
            color: var(--primary);
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .test-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px dashed rgba(0, 0, 0, 0.1);
        }

        .test-section h4 {
            color: var(--secondary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .test-section ol {
            padding-left: 20px;
        }

        .test-section li {
            margin-bottom: 12px;
            padding-left: 10px;
        }

        .answer-key {
            background-color: rgba(0, 102, 0, 0.05);
            border-left: 3px solid var(--success);
            padding: 15px;
            border-radius: 0 8px 8px 0;
            margin-top: 5px;
        }

        /* Parents Communication Section */
        .parents-container {
            margin-top: 1.5rem;
        }

        .search-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .parents-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--card-bg);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }

        .parents-table th, .parents-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .parents-table th {
            background-color: var(--primary);
            color: white;
            font-weight: 600;
        }

        .parents-table tr:nth-child(even) {
            background-color: rgba(0, 0, 0, 0.03);
        }

        .parents-table tr:hover {
            background-color: rgba(0, 102, 0, 0.05);
        }

        .communication-btn {
            padding: 0.5rem 1rem;
            border-radius: 5px;
            background-color: var(--info);
            color: white;
            border: none;
            cursor: pointer;
        }
        
        .phone-link, .email-link {
            color: var(--primary);
            text-decoration: none;
        }
        
        .phone-link:hover, .email-link:hover {
            text-decoration: underline;
        }

        /* Timetable Section */
        .timetable-container {
            margin-top: 1.5rem;
        }

        .timetable {
            display: grid;
            grid-template-columns: 100px repeat(5, 1fr);
            gap: 1px;
            background-color: #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }

        .timetable-header {
            background-color: var(--primary);
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: bold;
        }

        .timetable-cell {
            background-color: white;
            padding: 10px;
            min-height: 80px;
            position: relative;
        }
        
        .timetable-cell.editing {
            background-color: rgba(173, 216, 230, 0.3);
            cursor: pointer;
        }

        .timetable-cell.empty {
            background-color: #f9f9f9;
        }

        .timetable-class {
            background-color: rgba(0, 102, 0, 0.1);
            border-left: 3px solid var(--primary);
            padding: 8px;
            margin-bottom: 5px;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .delete-cell {
            position: absolute;
            top: 5px;
            right: 5px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 10px;
        }

        /* New animations and transitions */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .animated {
            animation-duration: 0.5s;
            animation-fill-mode: both;
        }
        
        .fadeInUp {
            animation-name: fadeInUp;
        }
        
        .bounce {
            animation-name: bounce;
            animation-duration: 0.8s;
            animation-iteration-count: 2;
        }
        
        .pulse {
            animation: pulse 1.5s infinite;
        }
        
        /* Enhanced transitions */
        .btn, .card, .nav-link, .sidebar-btn, .toggle-btn, .topic-card, .schedule-item {
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        
        /* Improved toast notifications */
        .toast {
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
        
        /* Enhanced pending tasks */
        .task-item.unread {
            animation: pulse 2s infinite;
            position: relative;
        }
        
        .task-item.unread::after {
            content: "";
            position: absolute;
            top: -5px;
            right: -5px;
            width: 12px;
            height: 12px;
            background-color: var(--secondary);
            border-radius: 50%;
            border: 2px solid var(--card-bg);
        }
        
        /* Improved upload area */
        .upload-area.active {
            border-color: var(--primary);
            background-color: rgba(0, 102, 0, 0.1);
            transform: scale(1.02);
        }
        
        /* Enhanced report card */
        .report-header {
            text-align: center;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        
        .report-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px dashed rgba(0, 0, 0, 0.1);
        }
        
        .report-section h4 {
            color: var(--secondary);
            margin-bottom: 10px;
        }
        
        /* Responsive improvements */
        @media (max-width: 1200px) {
            .lesson-planner-container, 
            .attendance-container {
                grid-template-columns: 1fr;
            }
            
            .grid-2col, .grid-3col {
                grid-template-columns: 1fr;
            }

            .schedule-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 992px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                position: fixed;
                top: var(--header-height);
                left: 0;
                width: 280px;
                height: calc(100vh - var(--header-height));
                transform: translateX(-100%);
                z-index: 90;
                transition: transform 0.3s ease;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .hamburger {
                display: flex;
                flex-direction: column;
                justify-content: center;
                gap: 5px;
                width: 40px;
                height: 40px;
                cursor: pointer;
                z-index: 101;
            }
            
            .hamburger div {
                width: 25px;
                height: 3px;
                background-color: var(--accent);
                transition: all 0.3s ease;
            }
            
            .hamburger.active div:nth-child(1) {
                transform: rotate(-45deg) translate(-5px, 6px);
            }
            
            .hamburger.active div:nth-child(2) {
                opacity: 0;
            }
            
            .hamburger.active div:nth-child(3) {
                transform: rotate(45deg) translate(-5px, -6px);
            }
            
            nav ul {
                display: none;
            }

            .profile-editor {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .main-content {
                padding: 1rem;
            }
            
            .attendance-controls {
                flex-direction: column;
            }
            
            .grade-table {
                font-size: 0.8rem;
            }
            
            .grade-table input {
                width: 50px;
                padding: 0.3rem;
            }
            
            .lesson-download {
                flex-direction: column;
                align-items: stretch;
            }
            
            .lesson-download .btn {
                width: 100%;
            }

            .schedule-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .timetable {
                grid-template-columns: 80px repeat(5, 1fr);
            }
        }

        @media (max-width: 480px) {
            .grid-3col, .grid-2col {
                grid-template-columns: 1fr;
            }
        }

        /* Utility Classes */
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mt-4 { margin-top: 2rem; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        .w-100 { width: 100%; }
        .text-center { text-align: center; }
        
        /* Loading spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--primary);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="toast" id="toast">Operation completed successfully!</div>
    
    <!-- Auth Pages -->
    <div class="auth-container" id="auth-page">
        <div class="auth-card" id="login-card">
            <div class="auth-logo">
                <div class="auth-icon">
                    <span>TT</span>
                </div>
                <div class="auth-text">Teachers Tool</div>
            </div>
            
            <form class="auth-form" id="login-form">
                <div class="form-group">
                    <label for="username"><i class="fas fa-user"></i> Username</label>
                    <input type="text" id="username" placeholder="Enter your username" required>
                </div>
                
                <div class="form-group">
                    <label for="password"><i class="fas fa-lock"></i> Password</label>
                    <input type="password" id="password" placeholder="Enter your password" required>
                </div>
                
                <button type="submit" class="auth-btn">Login</button>
            </form>
            
            <div class="auth-footer">
                <p>Don't have an account? <span class="auth-switch" id="show-register">Register</span></p>
                <p>© 2025 Teachers Tool - Enhanced Educational Platform</p>
                <p>For authorized personnel only</p>
            </div>
        </div>

        <div class="auth-card" id="register-card" style="display: none;">
            <div class="auth-logo">
                <div class="auth-icon">
                    <span>TT</span>
                </div>
                <div class="auth-text">Register Account</div>
            </div>
            
            <form class="auth-form" id="register-form">
                <div class="form-group">
                    <label for="full-name"><i class="fas fa-user"></i> Full Name</label>
                    <input type="text" id="full-name" placeholder="Enter your full name" required>
                </div>
                
                <div class="form-group">
                    <label for="reg-email"><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" id="reg-email" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label for="reg-username"><i class="fas fa-user"></i> Username</label>
                    <input type="text" id="reg-username" placeholder="Create a username" required>
                </div>
                
                <div class="form-group">
                    <label for="reg-password"><i class="fas fa-lock"></i> Password</label>
                    <input type="password" id="reg-password" placeholder="Create a password" required>
                </div>
                
                <div class="form-group">
                    <label for="confirm-password"><i class="fas fa-lock"></i> Confirm Password</label>
                    <input type="password" id="confirm-password" placeholder="Confirm your password" required>
                </div>
                
                <button type="submit" class="auth-btn">Register</button>
            </form>
            
            <div class="auth-footer">
                <p>Already have an account? <span class="auth-switch" id="show-login">Login</span></p>
                <p>© 2025 Teachers Tool - Enhanced Educational Platform</p>
            </div>
        </div>
    </div>
    
    <!-- Main Application (initially hidden) -->
    <div id="app-container" style="display:none;">
        <header>
            <div class="logo">
                <div class="logo-icon">
                    <span>TT</span>
                </div>
                <div class="logo-text">Teachers Tool</div>
            </div>
            
            <div class="hamburger" id="hamburger">
                <div></div>
                <div></div>
                <div></div>
            </div>
            
            <nav>
                <ul>
                    <li><a href="#" class="nav-link active" data-section="dashboard" aria-label="Dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                    <li><a href="#" class="nav-link" data-section="attendance" aria-label="Attendance"><i class="fas fa-clipboard-list"></i> Attendance</a></li>
                    <li><a href="#" class="nav-link" data-section="lesson-planner" aria-label="Lesson Planner"><i class="fas fa-calendar-alt"></i> Lesson Planner</a></li>
                    <li><a href="#" class="nav-link" data-section="gradebook" aria-label="Gradebook"><i class="fas fa-book-open"></i> Gradebook</a></li>
                    <li><a href="#" class="nav-link" data-section="test-generator" aria-label="Test Generator"><i class="fas fa-file-alt"></i> Test Generator</a></li>
                    <li><a href="#" class="nav-link" data-section="parents" aria-label="Parents"><i class="fas fa-users"></i> Parents</a></li>
                </ul>
            </nav>
            
            <div class="flex items-center gap-4">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode"></button>
                <div class="teacher-profile" id="profile-btn">
                    <div class="teacher-info">
                        <div class="name">Mr. Phiri</div>
                        <div class="role">Grade 1,3 Teacher</div>
                    </div>
                    <div class="teacher-avatar" id="user-avatar">
                        <div>MP</div>
                    </div>
                </div>
                <button class="btn btn-outline" id="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</button>
            </div>
        </header>

        <div class="container">
            <aside class="sidebar">
                <h2><i class="fas fa-tools"></i> Quick Tools</h2>
                <div class="sidebar-menu">
                    <button class="sidebar-btn active" data-section="dashboard"><i class="fas fa-home"></i> Dashboard</button>
                    <button class="sidebar-btn" data-section="gradebook"><i class="fas fa-book-open"></i> Gradebook</button>
                    <button class="sidebar-btn" data-section="attendance"><i class="fas fa-clipboard-list"></i> Attendance</button>
                    <button class="sidebar-btn" data-section="lesson-planner"><i class="fas fa-calendar-alt"></i> Lesson Planner</button>
                    <button class="sidebar-btn" data-section="test-generator"><i class="fas fa-file-alt"></i> Test Generator</button>
                    <button class="sidebar-btn" data-section="timetable"><i class="fas fa-clock"></i> Timetable</button>
                </div>

                <h2><i class="fas fa-history"></i> Recent Activities</h2>
                <div class="card">
                    <div class="card-content">
                        <p><i class="fas fa-calendar-check"></i> Updated Grade 3 Math grades</p>
                        <p class="mt-2"><i class="fas fa-file-alt"></i> Created Fractions test</p>
                        <p class="mt-2"><i class="fas fa-user-check"></i> Marked attendance for 14 Jun</p>
                    </div>
                </div>
                
                <h2><i class="fas fa-chart-line"></i> Performance</h2>
                <div class="card">
                    <div class="card-content">
                        <p>Mathematics: 87%</p>
                        <div class="progress-container">
                            <div class="progress-bar" style="width: 87%"></div>
                        </div>
                        
                        <p class="mt-2">English: 92%</p>
                        <div class="progress-container">
                            <div class="progress-bar" style="width: 92%"></div>
                        </div>
                    </div>
                </div>
            </aside>

            <main class="main-content">
                <!-- Dashboard Section -->
                <section class="dashboard-section active" id="dashboard">
                    <div class="section-header">
                        <h2><i class="fas fa-tachometer-alt"></i> Teacher Dashboard</h2>
                        <p>Welcome back, Mr. Phiri! Here's your daily overview and schedule.</p>
                    </div>
                    
                    <div class="dashboard-grid">
                        <div class="card">
                            <div class="card-content">
                                <h3><i class="fas fa-calendar-day"></i> Today's Schedule</h3>
                                <ul id="daily-schedule">
                                    <li><i class="fas fa-bell unread"></i> <strong>English Grade 1</strong> - 08:00 AM</li>
                                    <li><i class="fas fa-bell unread"></i> <strong>Mathematics Grade 2</strong> - 09:30 AM</li>
                                    <li><i class="fas fa-bell unread"></i> <strong>Science Grade 3</strong> - 11:00 AM</li>
                                    <li><i class="fas fa-bell unread"></i> <strong>Cinyanja Grade 3</strong> - 01:00 PM</li>
                                    <li><i class="fas fa-bell unread"></i> <strong>After School Club</strong> - 03:00 PM</li>
                                </ul>
                            </div>
                            <div class="card-footer">
                                <button class="btn btn-outline w-100" id="edit-schedule"><i class="fas fa-edit"></i> Edit Schedule</button>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-content">
                                <h3><i class="fas fa-tasks"></i> Pending Tasks</h3>
                                <ul id="pending-tasks">
                                    <li class="task-item unread" data-id="1"><i class="fas fa-bell"></i> Grade Term 2 assignments</li>
                                    <li class="task-item unread" data-id="2"><i class="fas fa-bell"></i> Prepare parent meeting notes</li>
                                    <li class="task-item unread" data-id="3"><i class="fas fa-bell"></i> Submit quarterly reports</li>
                                    <li class="task-item unread" data-id="4"><i class="fas fa-bell"></i> Review new curriculum</li>
                                    <li class="task-item unread" data-id="5"><i class="fas fa-bell"></i> Update class website</li>
                                </ul>
                            </div>
                            <div class="card-footer">
                                <button class="btn btn-primary w-100" id="view-tasks">View All Tasks</button>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-content">
                                <h3><i class="fas fa-bullhorn"></i> Announcements</h3>
                                <ul>
                                    <li><i class="fas fa-info-circle"></i> Field trip permission slips due Friday</li>
                                    <li><i class="fas fa-info-circle"></i> Parent-teacher conferences next week</li>
                                    <li><i class="fas fa-info-circle"></i> School closed on 15th for staff development</li>
                                    <li><i class="fas fa-info-circle"></i> New curriculum materials available</li>
                                    <li><i class="fas fa-info-circle"></i> Teacher training workshop next month</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-content">
                                <h3><i class="fas fa-chart-line"></i> Class Performance</h3>
                                <p>Mathematics: 87% average</p>
                                <div class="progress-container">
                                    <div class="progress-bar" style="width: 87%"></div>
                                </div>
                                
                                <p class="mt-2">English: 92% average</p>
                                <div class="progress-container">
                                    <div class="progress-bar" style="width: 92%"></div>
                                </div>
                                
                                <p class="mt-2">Science: 78% average</p>
                                <div class="progress-container">
                                    <div class="progress-bar" style="width: 78%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-content">
                                <h3><i class="fas fa-star"></i> Top Students</h3>
                                <ul>
                                    <li><i class="fas fa-medal"></i> Sarah Johnson - 98%</li>
                                    <li><i class="fas fa-medal"></i> Michael Brown - 96%</li>
                                    <li><i class="fas fa-medal"></i> Emily Davis - 95%</li>
                                    <li><i class="fas fa-medal"></i> David Banda - 94%</li>
                                    <li><i class="fas fa-medal"></i> Grace Phiri - 93%</li>
                                </ul>
                            </div>
                            <div class="card-footer">
                                <button class="btn btn-primary w-100" id="view-report">View Full Report</button>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-content">
                                <h3><i class="fas fa-lightbulb"></i> AI Suggestions</h3>
                                <p>Recommended resources for upcoming lessons:</p>
                                <ul>
                                    <li><i class="fas fa-link"></i> Interactive math games for algebra</li>
                                    <li><i class="fas fa-link"></i> Science experiment videos</li>
                                    <li><i class="fas fa-link"></i> Grammar worksheets bundle</li>
                                    <li><i class="fas fa-link"></i> Cultural heritage activities</li>
                                </ul>
                            </div>
                            <div class="card-footer">
                                <button class="btn btn-info w-100" id="view-resources">View Resources</button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Lesson Planner Section -->
                <section class="dashboard-section" id="lesson-planner">
                    <div class="section-header">
                        <h2><i class="fas fa-calendar-alt"></i> Lesson Plan Generator</h2>
                        <p>Create comprehensive lesson plans for your classes with AI assistance.</p>
                    </div>
                    
                    <div class="lesson-planner-container">
                        <div class="lesson-form">
                            <h3><i class="fas fa-cogs"></i> Lesson Settings</h3>
                            <div class="form-group mt-2">
                                <label for="lesson-subject"><i class="fas fa-book"></i> Subject:</label>
                                <select id="lesson-subject" class="form-control">
                                    <option value="math">Mathematics</option>
                                    <option value="english">English</option>
                                    <option value="science">Science</option>
                                    <option value="cinyanja">Cinyanja</option>
                                    <option value="history">History</option>
                                    <option value="art">Art</option>
                                    <option value="geography">Geography</option>
                                    <option value="music">Music</option>
                                    <option value="pe">Physical Education</option>
                                </select>
                            </div>
                            
                            <div class="form-group mt-2">
                                <label for="lesson-grade"><i class="fas fa-user-graduate"></i> Grade Level:</label>
                                <select id="lesson-grade" class="form-control">
                                    <option value="1">Grade 1</option>
                                    <option value="2">Grade 2</option>
                                    <option value="3" selected>Grade 3</option>
                                    <option value="4">Grade 4</option>
                                    <option value="5">Grade 5</option>
                                    <option value="6">Grade 6</option>
                                    <option value="7">Grade 7</option>
                                </select>
                            </div>
                            
                            <div class="form-group mt-2">
                                <label for="lesson-topic"><i class="fas fa-lightbulb"></i> Topic:</label>
                                <input type="text" id="lesson-topic" class="form-control" placeholder="Enter lesson topic">
                                
                                <!-- Suggested topics by subject -->
                                <div class="subject-topics" id="suggested-topics">
                                    <!-- Topics will be populated dynamically -->
                                </div>
                            </div>
                            
                            <div class="form-group mt-2">
                                <label for="lesson-duration"><i class="fas fa-clock"></i> Duration (minutes):</label>
                                <input type="number" id="lesson-duration" min="15" max="120" value="45" class="form-control">
                            </div>
                            
                            <div class="form-group mt-2">
                                <label for="lesson-objectives"><i class="fas fa-bullseye"></i> Learning Objectives:</label>
                                <textarea id="lesson-objectives" class="form-control" rows="3" placeholder="What should students learn?"></textarea>
                            </div>
                            
                            <div class="form-group mt-2">
                                <label for="lesson-materials"><i class="fas fa-tools"></i> Materials Needed:</label>
                                <textarea id="lesson-materials" class="form-control" rows="2" placeholder="List materials required"></textarea>
                            </div>
                            
                            <div class="flex gap-2">
                                <button class="btn btn-primary flex-1" id="generate-lesson-btn"><i class="fas fa-magic"></i> Generate</button>
                                <button class="btn btn-info flex-1" id="ai-enhance-btn"><i class="fas fa-robot"></i> AI Enhance</button>
                            </div>
                            
                            <div class="mt-2">
                                <button class="btn btn-outline w-100" id="save-template-btn"><i class="fas fa-save"></i> Save Template</button>
                            </div>
                        </div>
                        
                        <div class="lesson-preview">
                            <h3><i class="fas fa-file-alt"></i> Lesson Plan Preview</h3>
                            <div class="lesson-content mt-3" id="lesson-preview-content">
                                <div class="text-center">
                                    <p>Your lesson plan will appear here after generation</p>
                                    <p class="mt-2"><i class="fas fa-lightbulb text-warning"></i> Try generating a lesson plan for Mathematics - Fractions</p>
                                </div>
                            </div>
                            <div class="lesson-download">
                                <button class="btn btn-primary" id="print-lesson"><i class="fas fa-print"></i> Print</button>
                                <button class="btn btn-secondary" id="download-lesson"><i class="fas fa-download"></i> PDF</button>
                                <button class="btn btn-success" id="save-lesson"><i class="fas fa-save"></i> Save</button>
                                <button class="btn btn-purple" id="share-lesson"><i class="fas fa-share-alt"></i> Share</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card mt-4">
                        <h3><i class="fas fa-folder"></i> Saved Lesson Templates</h3>
                        <div class="dashboard-grid">
                            <div class="card">
                                <div class="card-content">
                                    <h4><i class="fas fa-calculator"></i> Mathematics - Fractions</h4>
                                    <p>Interactive lesson on fractions with Zambian context examples.</p>
                                </div>
                                <div class="card-footer">
                                    <button class="btn btn-outline w-100" data-template="fractions">Load Template</button>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-content">
                                    <h4><i class="fas fa-language"></i> Cinyanja - Greetings</h4>
                                    <p>Cultural language lesson with role-playing activities.</p>
                                </div>
                                <div class="card-footer">
                                    <button class="btn btn-outline w-100" data-template="greetings">Load Template</button>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-content">
                                    <h4><i class="fas fa-leaf"></i> Science - Ecosystems</h4>
                                    <p>Exploring Zambian ecosystems and conservation.</p>
                                </div>
                                <div class="card-footer">
                                    <button class="btn btn-outline w-100" data-template="ecosystems">Load Template</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Attendance Section -->
                <section class="dashboard-section" id="attendance">
                    <div class="section-header">
                        <h2><i class="fas fa-clipboard-list"></i> Attendance Tracker</h2>
                        <p>Track and manage student attendance with daily records.</p>
                    </div>
                    
                    <div class="attendance-container">
                        <div class="attendance-card">
                            <div class="attendance-header">
                                <h3>Today's Attendance</h3>
                                <div class="flex gap-2">
                                    <button class="btn btn-outline" id="save-attendance"><i class="fas fa-save"></i> Save</button>
                                    <button class="btn btn-secondary" id="add-student"><i class="fas fa-user-plus"></i> Add Student</button>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="attendance-date"><i class="fas fa-calendar"></i> Date:</label>
                                <input type="date" id="attendance-date" class="form-control" value="2025-06-14">
                            </div>
                            
                            <div class="student-list" id="attendance-list">
                                <div class="student-item">
                                    <div>Manase Banda</div>
                                    <div class="attendance-toggle">
                                        <button class="toggle-btn active">Present</button>
                                        <button class="toggle-btn absent">Absent</button>
                                        <button class="toggle-btn late">Late</button>
                                    </div>
                                </div>
                                <div class="student-item">
                                    <div>Daliso Banda</div>
                                    <div class="attendance-toggle">
                                        <button class="toggle-btn">Present</button>
                                        <button class="toggle-btn absent active">Absent</button>
                                        <button class="toggle-btn late">Late</button>
                                    </div>
                                </div>
                                <div class="student-item">
                                    <div>Abraham Chomba</div>
                                    <div class="attendance-toggle">
                                        <button class="toggle-btn active">Present</button>
                                        <button class="toggle-btn absent">Absent</button>
                                        <button class="toggle-btn late">Late</button>
                                    </div>
                                </div>
                                <div class="student-item">
                                    <div>Chanda Mwale</div>
                                    <div class="attendance-toggle">
                                        <button class="toggle-btn">Present</button>
                                        <button class="toggle-btn absent">Absent</button>
                                        <button class="toggle-btn late active">Late</button>
                                    </div>
                                </div>
                                <div class="student-item">
                                    <div>Davies Lungu</div>
                                    <div class="attendance-toggle">
                                        <button class="toggle-btn active">Present</button>
                                        <button class="toggle-btn absent">Absent</button>
                                        <button class="toggle-btn late">Late</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="attendance-card">
                            <h3>Attendance Summary</h3>
                            <div class="dashboard-grid mt-3">
                                <div class="card">
                                    <div class="card-content">
                                        <h4><i class="fas fa-user-check"></i> Present</h4>
                                        <div class="stat-value" id="present-count">3</div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-content">
                                        <h4><i class="fas fa-user-times"></i> Absent</h4>
                                        <div class="stat-value" id="absent-count">1</div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-content">
                                        <h4><i class="fas fa-clock"></i> Late</h4>
                                        <div class="stat-value" id="late-count">1</div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-content">
                                        <h4><i class="fas fa-users"></i> Total Students</h4>
                                        <div class="stat-value" id="total-count">5</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mt-3">
                                <h4>Attendance History</h4>
                                <div class="student-list">
                                    <div class="student-item">
                                        <div>14 Jun 2025</div>
                                        <div>4 Present, 1 Absent</div>
                                    </div>
                                    <div class="student-item">
                                        <div>13 Jun 2025</div>
                                        <div>5 Present</div>
                                    </div>
                                    <div class="student-item">
                                        <div>12 Jun 2025</div>
                                        <div>4 Present, 1 Late</div>
                                    </div>
                                    <div class="student-item">
                                        <div>11 Jun 2025</div>
                                        <div>3 Present, 2 Absent</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Gradebook Section -->
                <section class="dashboard-section" id="gradebook">
                    <div class="section-header">
                        <h2><i class="fas fa-book-open"></i> Gradebook</h2>
                        <p>Manage and track student grades and performance. Download individual report forms.</p>
                    </div>
                    
                    <div class="gradebook-container">
                        <div class="card">
                            <div class="flex justify-between items-center mb-3">
                                <h3>Grade 3 - Term 2 Results</h3>
                                <div class="action-buttons">
                                    <button class="btn btn-success" id="add-student-grade"><i class="fas fa-user-plus"></i> Add Student</button>
                                    <button class="btn btn-danger" id="delete-student"><i class="fas fa-user-minus"></i> Remove</button>
                                    <button class="btn btn-gold" id="generate-reports"><i class="fas fa-file-pdf"></i> Export All</button>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="grade-table">
                                    <thead>
                                        <tr>
                                            <th>Student</th>
                                            <th>Mathematics</th>
                                            <th>English</th>
                                            <th>Science</th>
                                            <th>Cinyanja</th>
                                            <th>History</th>
                                            <th>Art</th>
                                            <th>Music</th>
                                            <th>PE</th>
                                            <th>Average</th>
                                        </tr>
                                    </thead>
                                    <tbody id="gradebook-body">
                                        <!-- Students will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="grade-actions">
                            <button class="btn btn-primary" id="save-grades"><i class="fas fa-save"></i> Save Grades</button>
                            <div class="text-center">
                                <p class="text-muted">Click on student name to select, then click "Remove" to delete</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Test Generator Section -->
                <section class="dashboard-section" id="test-generator">
                    <div class="section-header">
                        <h2><i class="fas fa-file-alt"></i> Test Generator</h2>
                        <p>Create customized tests and quizzes for your students with over 50 questions per subject.</p>
                    </div>
                    
                    <div class="lesson-planner-container">
                        <div class="lesson-form">
                            <h3><i class="fas fa-cogs"></i> Test Settings</h3>
                            <div class="form-group mt-2">
                                <label for="test-subject"><i class="fas fa-book"></i> Subject:</label>
                                <select id="test-subject" class="form-control">
                                    <option value="math">Mathematics</option>
                                    <option value="english">English</option>
                                    <option value="science">Science</option>
                                    <option value="cinyanja">Cinyanja</option>
                                    <option value="history">History</option>
                                    <option value="geography">Geography</option>
                                    <option value="art">Art</option>
                                </select>
                            </div>
                            
                            <div class="form-group mt-2">
                                <label for="test-grade"><i class="fas fa-user-graduate"></i> Grade Level:</label>
                                <select id="test-grade" class="form-control">
                                    <option value="1">Grade 1</option>
                                    <option value="2">Grade 2</option>
                                    <option value="3" selected>Grade 3</option>
                                    <option value="4">Grade 4</option>
                                    <option value="5">Grade 5</option>
                                </select>
                            </div>
                            
                            <div class="form-group mt-2">
                                <label for="test-topic"><i class="fas fa-lightbulb"></i> Topic:</label>
                                <input type="text" id="test-topic" class="form-control" placeholder="Enter test topic">
                            </div>
                            
                            <div class="form-group mt-2">
                                <label for="test-duration"><i class="fas fa-clock"></i> Duration (minutes):</label>
                                <input type="number" id="test-duration" min="15" max="120" value="30" class="form-control">
                            </div>
                            
                            <div class="form-group mt-2">
                                <label for="question-count"><i class="fas fa-question-circle"></i> Number of Questions:</label>
                                <input type="number" id="question-count" min="5" max="50" value="10" class="form-control">
                            </div>
                            
                            <div class="flex gap-2">
                                <button class="btn btn-primary flex-1" id="generate-test-btn"><i class="fas fa-magic"></i> Generate Test</button>
                                <button class="btn btn-info flex-1" id="ai-enhance-test-btn"><i class="fas fa-robot"></i> AI Enhance</button>
                            </div>
                        </div>
                        
                        <div class="lesson-preview">
                            <h3><i class="fas fa-file-alt"></i> Test Preview</h3>
                            <div class="test-content mt-3" id="test-preview-content">
                                <div class="text-center">
                                    <p>Your test will appear here after generation</p>
                                    <p class="mt-2"><i class="fas fa-lightbulb text-warning"></i> Try generating a test for Mathematics - Fractions</p>
                                </div>
                            </div>
                            <div class="lesson-download">
                                <button class="btn btn-primary" id="print-test"><i class="fas fa-print"></i> Print</button>
                                <button class="btn btn-secondary" id="download-test"><i class="fas fa-download"></i> PDF</button>
                                <button class="btn btn-success" id="save-test"><i class="fas fa-save"></i> Save</button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Parents Communication Section -->
                <section class="dashboard-section" id="parents">
                    <div class="section-header">
                        <h2><i class="fas fa-users"></i> Parents Communication</h2>
                        <p>Manage parent contacts and communicate with guardians.</p>
                    </div>
                    
                    <div class="parents-container">
                        <div class="search-bar">
                            <input type="text" id="parent-search" class="form-control" placeholder="Search parents or students...">
                            <button class="btn btn-primary" id="search-parents"><i class="fas fa-search"></i> Search</button>
                            <button class="btn btn-success" id="add-parent"><i class="fas fa-user-plus"></i> Add Parent</button>
                        </div>
                        
                        <table class="parents-table">
                            <thead>
                                <tr>
                                    <th>Parent Name</th>
                                    <th>Student Name</th>
                                    <th>Relationship</th>
                                    <th>Phone</th>
                                    <th>Email</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="parents-list">
                                <tr>
                                    <td>Esther Banda</td>
                                    <td>Manase Banda</td>
                                    <td>Mother</td>
                                    <td><a href="tel:+260971234567" class="phone-link">+260 97 123 4567</a></td>
                                    <td><a href="mailto:esther@example.com" class="email-link">esther@example.com</a></td>
                                    <td><button class="communication-btn" data-email="esther@example.com" data-phone="+260971234567"><i class="fas fa-envelope"></i> Message</button></td>
                                </tr>
                                <tr>
                                    <td>Joseph Mwale</td>
                                    <td>Chanda Mwale</td>
                                    <td>Father</td>
                                    <td><a href="tel:+260969876543" class="phone-link">+260 96 987 6543</a></td>
                                    <td><a href="mailto:joseph@example.com" class="email-link">joseph@example.com</a></td>
                                    <td><button class="communication-btn" data-email="joseph@example.com" data-phone="+260969876543"><i class="fas fa-envelope"></i> Message</button></td>
                                </tr>
                                <tr>
                                    <td>Grace Chomba</td>
                                    <td>Abraham Chomba</td>
                                    <td>Mother</td>
                                    <td><a href="tel:+260975551234" class="phone-link">+260 97 555 1234</a></td>
                                    <td><a href="mailto:grace@example.com" class="email-link">grace@example.com</a></td>
                                    <td><button class="communication-btn" data-email="grace@example.com" data-phone="+260975551234"><i class="fas fa-envelope"></i> Message</button></td>
                                </tr>
                                <tr>
                                    <td>Peter Lungu</td>
                                    <td>Davies Lungu</td>
                                    <td>Father</td>
                                    <td><a href="tel:+260967778888" class="phone-link">+260 96 777 8888</a></td>
                                    <td><a href="mailto:peter@example.com" class="email-link">peter@example.com</a></td>
                                    <td><button class="communication-btn" data-email="peter@example.com" data-phone="+260967778888"><i class="fas fa-envelope"></i> Message</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Timetable Section -->
                <section class="dashboard-section" id="timetable">
                    <div class="section-header">
                        <h2><i class="fas fa-clock"></i> Timetable Management</h2>
                        <p>Create and manage your teaching schedule.</p>
                    </div>
                    
                    <div class="timetable-container">
                        <div class="card">
                            <div class="flex justify-between items-center mb-3">
                                <h3>Weekly Timetable</h3>
                                <div>
                                    <button class="btn btn-primary" id="save-timetable"><i class="fas fa-save"></i> Save</button>
                                    <button class="btn btn-edit" id="edit-timetable"><i class="fas fa-edit"></i> Edit</button>
                                    <button class="btn btn-secondary" id="print-timetable"><i class="fas fa-print"></i> Print</button>
                                </div>
                            </div>
                            
                            <div class="timetable" id="timetable-grid">
                                <div class="timetable-header">Time</div>
                                <div class="timetable-header">Monday</div>
                                <div class="timetable-header">Tuesday</div>
                                <div class="timetable-header">Wednesday</div>
                                <div class="timetable-header">Thursday</div>
                                <div class="timetable-header">Friday</div>
                                
                                <!-- 08:00 -->
                                <div class="timetable-header">08:00</div>
                                <div class="timetable-cell">
                                    <div class="timetable-class">Math Grade 3</div>
                                    <div class="timetable-class">Room 12</div>
                                </div>
                                <div class="timetable-cell empty"></div>
                                <div class="timetable-cell">
                                    <div class="timetable-class">Science Grade 3</div>
                                    <div class="timetable-class">Lab 3</div>
                                </div>
                                <div class="timetable-cell">
                                    <div class="timetable-class">English Grade 3</div>
                                    <div class="timetable-class">Room 8</div>
                                </div>
                                <div class="timetable-cell empty"></div>
                                
                                <!-- 09:00 -->
                                <div class="timetable-header">09:00</div>
                                <div class="timetable-cell empty"></div>
                                <div class="timetable-cell">
                                    <div class="timetable-class">Cinyanja Grade 3</div>
                                    <div class="timetable-class">Room 10</div>
                                </div>
                                <div class="timetable-cell empty"></div>
                                <div class="timetable-cell">
                                    <div class="timetable-class">History Grade 3</div>
                                    <div class="timetable-class">Room 5</div>
                                </div>
                                <div class="timetable-cell">
                                    <div class="timetable-class">Art Grade 3</div>
                                    <div class="timetable-class">Art Room</div>
                                </div>
                                
                                <!-- More timetable rows would go here -->
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>

        <footer>
            <p>Created by Teacher Phiri at Agape Academy</p>
            <p>&copy; 2025 Teachers Tool - Enhanced Educational Platform. All rights reserved.</p>
        </footer>
    </div>

    <!-- Modals -->
    <div class="modal" id="schedule-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-calendar-edit"></i> Edit Schedule</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="schedule-date"><i class="fas fa-calendar"></i> Select Date:</label>
                    <input type="date" id="schedule-date" class="form-control" value="2025-06-21">
                </div>
                
                <h4 class="mt-3">Schedule Items:</h4>
                <div class="schedule-grid">
                    <div class="schedule-item" data-time="08:00">08:00 AM</div>
                    <div class="schedule-item" data-time="09:30">09:30 AM</div>
                    <div class="schedule-item" data-time="11:00">11:00 AM</div>
                    <div class="schedule-item" data-time="01:00">01:00 PM</div>
                    <div class="schedule-item" data-time="03:00">03:00 PM</div>
                </div>
                
                <div class="form-group mt-3">
                    <label for="class-name"><i class="fas fa-book"></i> Class/Activity:</label>
                    <input type="text" id="class-name" class="form-control" placeholder="Enter class or activity">
                </div>
                
                <div class="form-group">
                    <label for="class-details"><i class="fas fa-info-circle"></i> Details:</label>
                    <textarea id="class-details" class="form-control" rows="3" placeholder="Enter class details"></textarea>
                </div>
                
                <div class="flex justify-between mt-3">
                    <button class="btn btn-outline" id="add-schedule-item"><i class="fas fa-plus"></i> Add Item</button>
                    <button class="btn btn-primary" id="save-schedule"><i class="fas fa-save"></i> Save Schedule</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="profile-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-user-edit"></i> Edit Profile</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="profile-editor">
                    <div class="profile-preview">
                        <div class="profile-avatar" id="profile-avatar">MP</div>
                        <input type="file" id="avatar-upload" accept="image/*" style="display: none;">
                        <button class="btn btn-outline" id="change-avatar"><i class="fas fa-camera"></i> Change Photo</button>
                    </div>
                    <div class="profile-form">
                        <div class="form-group">
                            <label for="full-name"><i class="fas fa-user"></i> Full Name:</label>
                            <input type="text" id="full-name" class="form-control" value="Mr. Phiri">
                        </div>
                        
                        <div class="form-group">
                            <label for="email"><i class="fas fa-envelope"></i> Email:</label>
                            <input type="email" id="email" class="form-control" value="phiri@agape.edu.zm">
                        </div>
                        
                        <div class="form-group">
                            <label for="phone"><i class="fas fa-phone"></i> Phone:</label>
                            <input type="tel" id="phone" class="form-control" value="+260 97 123 4567">
                        </div>
                        
                        <div class="form-group">
                            <label for="subjects"><i class="fas fa-book"></i> Subjects Taught:</label>
                            <input type="text" id="subjects" class="form-control" value="Mathematics, Science, Cinyanja">
                        </div>
                        
                        <div class="form-group">
                            <label for="grades"><i class="fas fa-graduation-cap"></i> Grades:</label>
                            <input type="text" id="grades" class="form-control" value="Grade 1, Grade 3">
                        </div>
                        
                        <div class="form-group">
                            <label for="bio"><i class="fas fa-file-alt"></i> Bio:</label>
                            <textarea id="bio" class="form-control" rows="3">Experienced teacher with 8 years of teaching Mathematics and Science. Passionate about Zambian education.</textarea>
                        </div>
                        
                        <button class="btn btn-primary" id="save-profile"><i class="fas fa-save"></i> Save Profile</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- New Modals -->
    <div class="modal" id="tasks-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-tasks"></i> All Tasks</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <ul id="all-tasks-list">
                    <!-- Tasks will be added here -->
                </ul>
            </div>
        </div>
    </div>

    <div class="modal" id="resources-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-lightbulb"></i> AI Suggested Resources</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <ul id="resources-list">
                    <!-- Resources will be added here -->
                </ul>
            </div>
        </div>
    </div>

    <div class="modal" id="report-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-chart-line"></i> Class Performance Report</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="report-content">
                    <!-- Report content will be added here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Parent Modal -->
    <div class="modal" id="add-parent-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-user-plus"></i> Add Parent</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="add-parent-form">
                    <div class="form-group">
                        <label for="parent-name">Parent Name:</label>
                        <input type="text" id="parent-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="student-name">Student Name:</label>
                        <input type="text" id="student-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="relationship">Relationship:</label>
                        <select id="relationship" class="form-control" required>
                            <option value="Mother">Mother</option>
                            <option value="Father">Father</option>
                            <option value="Guardian">Guardian</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="parent-phone">Phone:</label>
                        <input type="tel" id="parent-phone" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="parent-email">Email:</label>
                        <input type="email" id="parent-email" class="form-control" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">Add Parent</button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Communication Modal -->
    <div class="modal" id="communication-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-comments"></i> Contact Parent</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="parent-email">To:</label>
                    <input type="text" id="comms-email" class="form-control" readonly>
                </div>
                <div class="form-group">
                    <label for="parent-phone">Phone:</label>
                    <input type="text" id="comms-phone" class="form-control" readonly>
                </div>
                <div class="form-group">
                    <label for="message-subject">Subject:</label>
                    <input type="text" id="message-subject" class="form-control" placeholder="Subject">
                </div>
                <div class="form-group">
                    <label for="message-content">Message:</label>
                    <textarea id="message-content" class="form-control" rows="5" placeholder="Type your message here..."></textarea>
                </div>
                <div class="flex gap-2 mt-3">
                    <button class="btn btn-primary flex-1" id="send-email-btn"><i class="fas fa-envelope"></i> Send Email</button>
                    <button class="btn btn-success flex-1" id="call-parent-btn"><i class="fas fa-phone"></i> Call Now</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Edit Timetable Modal -->
    <div class="modal" id="edit-timetable-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-edit"></i> Edit Timetable Entry</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="timetable-day">Day:</label>
                    <select id="timetable-day" class="form-control">
                        <option value="Monday">Monday</option>
                        <option value="Tuesday">Tuesday</option>
                        <option value="Wednesday">Wednesday</option>
                        <option value="Thursday">Thursday</option>
                        <option value="Friday">Friday</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="timetable-time">Time:</label>
                    <select id="timetable-time" class="form-control">
                        <option value="08:00">08:00 AM</option>
                        <option value="09:00">09:00 AM</option>
                        <option value="10:00">10:00 AM</option>
                        <option value="11:00">11:00 AM</option>
                        <option value="12:00">12:00 PM</option>
                        <option value="13:00">01:00 PM</option>
                        <option value="14:00">02:00 PM</option>
                        <option value="15:00">03:00 PM</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="timetable-class">Class:</label>
                    <input type="text" id="timetable-class" class="form-control" placeholder="Class name">
                </div>
                <div class="form-group">
                    <label for="timetable-location">Location:</label>
                    <input type="text" id="timetable-location" class="form-control" placeholder="Room/location">
                </div>
                <div class="flex justify-between mt-3">
                    <button class="btn btn-danger" id="delete-entry-btn"><i class="fas fa-trash"></i> Delete</button>
                    <button class="btn btn-primary" id="save-entry-btn"><i class="fas fa-save"></i> Save</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data definitions
        const zambianNames = [
            "Chanda Banda", "Mwila Mwansa", "Tembo Lungu", "Nkosi Phiri", "Kasonde Mwale",
            "Zulu Soko", "Chileshe Ngoma", "Bwalya Kunda", "Mutale Chisenga", "Mukuka Mumba",
            "Chilufya Mulenga", "Mwape Kapembwa", "Mwila Tembo", "Chola Chisala", "Kabwe Mwila",
            "Zikomo Mwansa", "Nsofwa Siamayuwa", "Chilando Mwape", "Mubanga Chilufya", "Kabaso Mwila",
            "Chanda Mwansa", "Mwila Banda", "Tembo Phiri", "Nkosi Mwale", "Kasonde Soko",
            "Zulu Ngoma", "Chileshe Kunda", "Bwalya Chisenga", "Mutale Mumba", "Mukuka Mulenga",
            "Chilufya Kapembwa", "Mwape Tembo", "Mwila Chisala", "Chola Mwila", "Kabwe Mwansa",
            "Zikomo Siamayuwa", "Nsofwa Mwape", "Chilando Chilufya", "Mubanga Mwila", "Kabaso Banda",
            "Mwape Phiri", "Chisenga Mwale", "Kunda Soko", "Ngoma Ngoma", "Soko Kunda",
            "Phiri Chisenga", "Mwale Mumba", "Banda Mulenga", "Lungu Kapembwa", "Siamayuwa Tembo"
        ];
        
        const questionBanks = {
            math: [
                { q: "What is 3/4 of 100?", a: "75" },
                { q: "If a rectangle has length 8cm and width 5cm, what is its area?", a: "40cm²" },
                { q: "Solve for x: 2x + 5 = 15", a: "x = 5" },
                { q: "What is the perimeter of a square with side length 6cm?", a: "24cm" },
                { q: "Convert 0.75 to a fraction in simplest form", a: "3/4" },
                { q: "Calculate 7² - 5²", a: "24" },
                { q: "If 5 pencils cost 25 kwacha, how much do 8 pencils cost?", a: "40 kwacha" },
                { q: "What is 15% of 200?", a: "30" },
                { q: "Simplify 3/6 to its lowest terms", a: "1/2" },
                { q: "Add 2/3 + 1/4", a: "11/12" },
                { q: "If a bag of mealie meal costs 150 Kwacha, and you buy 3 bags, how much do you spend?", a: "450 Kwacha" },
                { q: "Calculate the area of a maize field that is 20m long and 15m wide.", a: "300m²" },
                { q: "If 5 students share 25 exercise books equally, how many books does each get?", a: "5 books" },
                { q: "Convert 3.5 hours to minutes.", a: "210 minutes" },
                { q: "What is the perimeter of a rectangular classroom that is 10m by 8m?", a: "36m" }
            ],
            english: [
                { q: "Identify the verb in this sentence: 'The dog chased the cat.'", a: "chased" },
                { q: "What is the past tense of 'go'?", a: "went" },
                { q: "Correct the sentence: 'She don't like apples.'", a: "She doesn't like apples." },
                { q: "What is the plural of 'child'?", a: "children" },
                { q: "Identify the adjective in: 'The tall man walked quickly.'", a: "tall" },
                { q: "What is a synonym for 'happy'?", a: "joyful" },
                { q: "What is the opposite of 'ancient'?", a: "modern" },
                { q: "Identify the subject in: 'After school, the children played football.'", a: "the children" },
                { q: "Change to passive voice: 'The teacher praised the student.'", a: "The student was praised by the teacher." },
                { q: "What is the comparative form of 'good'?", a: "better" },
                { q: "Complete the sentence: 'The Zambezi River ____ through Zambia.'", a: "flows" },
                { q: "Give the plural form of 'child' as used in Zambian English.", a: "children" },
                { q: "What is the opposite of 'wealthy'?", a: "poor" },
                { q: "Identify the verb: 'The teacher taught the students about Zambian history.'", a: "taught" },
                { q: "Form a question: 'They are going to the market.'", a: "Are they going to the market?" }
            ],
            science: [
                { q: "What gas do plants absorb during photosynthesis?", a: "Carbon dioxide" },
                { q: "Name the three states of matter", a: "Solid, liquid, gas" },
                { q: "Which planet is known as the Red Planet?", a: "Mars" },
                { q: "What is the main function of the roots in a plant?", a: "Absorb water and nutrients" },
                { q: "What force keeps us on the ground?", a: "Gravity" },
                { q: "Name the process by which water turns into vapor", a: "Evaporation" },
                { q: "What is the largest organ in the human body?", a: "Skin" },
                { q: "What do we call an animal that eats both plants and meat?", a: "Omnivore" },
                { q: "Which part of the plant makes food?", a: "Leaves" },
                { q: "What gas do humans breathe out?", a: "Carbon dioxide" },
                { q: "What gas do plants absorb during photosynthesis?", a: "Carbon dioxide" },
                { q: "Name the three states of matter", a: "Solid, liquid, gas" },
                { q: "Which planet is known as the Red Planet?", a: "Mars" },
                { q: "What is the main function of the roots in a plant?", a: "Absorb water and nutrients" },
                { q: "What force keeps us on the ground?", a: "Gravity" }
            ],
            cinyanja: [
                { q: "What is 'hello' in Cinyanja?", a: "Moni" },
                { q: "How do you say 'thank you'?", a: "Zikomo" },
                { q: "Translate 'good morning' to Cinyanja", a: "Mwauka bwanji?" },
                { q: "What is the Cinyanja word for 'water'?", a: "Madzi" },
                { q: "How do you say 'I'm fine' in response to 'Muli bwanji?'", a: "Ndili bwino" },
                { q: "What does 'dzina langa ndi...' mean?", a: "My name is..." },
                { q: "How do you say 'school' in Cinyanja?", a: "Sukulu" },
                { q: "Translate 'teacher' to Cinyanja", a: "Mphunzitsi" },
                { q: "What is 'one' in Cinyanja?", a: "Modzi" },
                { q: "How do you say 'goodbye' in Cinyanja?", a: "Pitani bwino" }
            ],
            history: [
                { q: "Who was the first president of Zambia?", a: "Kenneth Kaunda" },
                { q: "In what year did Zambia gain independence?", a: "1964" },
                { q: "What was Zambia called before independence?", a: "Northern Rhodesia" },
                { q: "Name the famous Zambian freedom fighter known as 'Black Mamba'", a: "Simon Kapwepwe" },
                { q: "What major river forms Zambia's southern border?", a: "Zambezi" },
                { q: "What is the name of the famous waterfall on the Zambezi River?", a: "Victoria Falls" },
                { q: "Which ethnic group is the largest in Zambia?", a: "Bemba" },
                { q: "What is the traditional ceremony of the Lozi people called?", a: "Kuomboka" },
                { q: "Which colonial power ruled Zambia before independence?", a: "Britain" },
                { q: "What is the capital city of Zambia?", a: "Lusaka" }
            ],
            geography: [
                { q: "Name Zambia's neighboring countries (name at least four)", a: "Angola, Botswana, DR Congo, Malawi, Mozambique, Namibia, Tanzania, Zimbabwe" },
                { q: "What is the highest point in Zambia?", a: "Mafinga Hills" },
                { q: "Which large lake is shared by Zambia and Zimbabwe?", a: "Lake Kariba" },
                { q: "What is the name of Zambia's largest national park?", a: "Kafue National Park" },
                { q: "Which river forms part of Zambia's border with Zimbabwe?", a: "Zambezi" },
                { q: "What type of climate does Zambia have?", a: "Tropical" },
                { q: "What is the main mineral resource of Zambia?", a: "Copper" },
                { q: "What is the name of the swamp area in Zambia?", a: "Bangweulu Swamps" },
                { q: "Which Zambian province is known for copper mining?", a: "Copperbelt" },
                { q: "What is the name of the famous waterfall in Zambia?", a: "Victoria Falls" }
            ]
        };

        const subjectTopics = {
            math: ["Addition and Subtraction", "Multiplication", "Fractions", "Shapes and Geometry", 
                   "Measurement", "Word Problems", "Decimals", "Percentages", "Algebra", "Data Handling"],
            english: ["Parts of Speech", "Reading Comprehension", "Creative Writing", "Grammar", 
                     "Vocabulary", "Punctuation", "Poetry", "Narrative Writing", "Debate", "Letter Writing"],
            science: ["States of Matter", "Human Body", "Plants", "Animals", "Ecosystems", 
                     "Electricity", "Solar System", "Weather", "Forces and Motion", "Energy"],
            cinyanja: ["Greetings", "Family", "Food", "Numbers", "Colors", "Animals", 
                      "Daily Activities", "Weather", "Shopping", "Travel"],
            history: ["Pre-colonial Zambia", "Independence Struggle", "Traditional Leaders", "Zambian Culture", 
                     "National Symbols", "Economic History", "Political History", "Famous Zambians", 
                     "Traditional Ceremonies", "Colonial Era"],
            art: ["Drawing Techniques", "Color Theory", "Zambian Crafts", "Sculpture", "Painting", 
                 "Art History", "Textile Design", "Pottery", "Printmaking", "Digital Art"],
            geography: ["Map Skills", "Zambian Provinces", "Rivers of Zambia", "Climate", "Agriculture", 
                       "Mining", "Conservation", "Population", "Urbanization", "Water Resources"],
            music: ["Rhythm and Beat", "Traditional Zambian Music", "Singing Techniques", "Music Theory", 
                   "Instrument Families", "Composition", "Music History", "Performance Skills", 
                   "Zambian Folk Songs", "Music and Culture"],
            pe: ["Team Sports", "Fitness Training", "Athletics", "Gymnastics", "Swimming", 
                "Traditional Zambian Games", "Health and Wellness", "Coordination Skills", 
                "Outdoor Activities", "Dance and Movement"]
        };

        const zambianLessonComponents = {
            introduction: [
                "Begin by relating the topic to everyday Zambian life. For example, use local fruits to demonstrate fractions.",
                "Start with a Zambian proverb that relates to the lesson topic: 'Umwana ashenda atasha nyina ukunaya' (A child who washes his hands gets to eat with elders).",
                "Introduce the topic through a popular Zambian story or folktale.",
                "Connect the lesson to current events in Zambia.",
                "Use Zambian currency examples to explain mathematical concepts."
            ],
            activity: [
                "Organize a group activity using local materials like maize, beans, or stones.",
                "Create a role-play scenario based on Zambian cultural practices.",
                "Conduct an outdoor activity exploring local plants and wildlife.",
                "Design a project that addresses a community issue in Zambia.",
                "Organize a debate on a topic relevant to Zambian society."
            ],
            assessment: [
                "Create a worksheet using Zambian context examples.",
                "Assign a project that requires research on Zambian culture or history.",
                "Use peer assessment with culturally relevant criteria.",
                "Incorporate oral presentations on Zambian topics.",
                "Design a quiz with questions based on Zambian examples."
            ],
            homework: [
                "Interview family members about traditional practices related to the topic.",
                "Collect local materials for a class project.",
                "Research a Zambian historical figure related to the subject.",
                "Write a short essay on how the topic applies to Zambian society.",
                "Solve problems using Zambian currency or measurements."
            ]
        };

        // Pending tasks with read status
        const pendingTasks = [
            { id: 1, text: "Grade Term 2 assignments", read: false },
            { id: 2, text: "Prepare parent meeting notes", read: false },
            { id: 3, text: "Submit quarterly reports to headmaster", read: false },
            { id: 4, text: "Review new Zambian curriculum documents", read: false },
            { id: 5, text: "Update class website with new photos", read: false }
        ];
        
        // Parents data
        const parentsData = [
            { parent: "Esther Banda", student: "Manase Banda", relationship: "Mother", phone: "+260 97 123 4567", email: "esther@example.com" },
            { parent: "Joseph Mwale", student: "Chanda Mwale", relationship: "Father", phone: "+260 96 987 6543", email: "joseph@example.com" },
            { parent: "Grace Chomba", student: "Abraham Chomba", relationship: "Mother", phone: "+260 97 555 1234", email: "grace@example.com" },
            { parent: "Peter Lungu", student: "Davies Lungu", relationship: "Father", phone: "+260 96 777 8888", email: "peter@example.com" },
            { parent: "Miriam Zulu", student: "Sarah Zulu", relationship: "Mother", phone: "+260 97 888 9999", email: "miriam@example.com" }
        ];
        
        // Timetable data
        const timetableData = [
            { time: "08:00", monday: "Math Grade 3\nRoom 12", tuesday: "", wednesday: "Science Grade 3\nLab 3", thursday: "English Grade 3\nRoom 8", friday: "" },
            { time: "09:00", monday: "", tuesday: "Cinyanja Grade 3\nRoom 10", wednesday: "", thursday: "History Grade 3\nRoom 5", friday: "Art Grade 3\nArt Room" },
            { time: "10:00", monday: "Science Grade 1\nLab 1", tuesday: "Math Grade 2\nRoom 7", wednesday: "English Grade 2\nRoom 6", thursday: "PE\nField", friday: "Music\nHall" },
            { time: "11:00", monday: "Break", tuesday: "Break", wednesday: "Break", thursday: "Break", friday: "Break" },
            { time: "11:30", monday: "English Grade 1\nRoom 3", tuesday: "Science Grade 2\nLab 2", wednesday: "Math Grade 1\nRoom 4", thursday: "Civics Grade 3\nRoom 9", friday: "Library" }
        ];

        // Resources
        const resources = [
            "Interactive math games for algebra",
            "Science experiment videos",
            "Grammar worksheets bundle",
            "Cultural heritage activities",
            "Zambian history documentaries",
            "Traditional Zambian music collection",
            "Cinyanja language flashcards"
        ];

        // DOM Elements
        const toast = document.getElementById('toast');
        const loginPage = document.getElementById('auth-page');
        const appContainer = document.getElementById('app-container');
        const loginCard = document.getElementById('login-card');
        const registerCard = document.getElementById('register-card');
        const showRegister = document.getElementById('show-register');
        const showLogin = document.getElementById('show-login');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        
        // User authentication state
        let currentUser = null;
        let authState = 'login'; // 'login' or 'register'
        
        // Timetable editing state
        let isTimetableEditing = false;
        let selectedCell = null;
        
        // Utility Functions
        function showToast(message, type = 'success') {
            toast.textContent = message;
            toast.className = 'toast show';
            if (type === 'error') toast.classList.add('error');
            if (type === 'warning') toast.classList.add('warning');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function sanitizeInput(input) {
            const div = document.createElement('div');
            div.textContent = input;
            return div.innerHTML;
        }

        function switchSection(sectionId) {
            const sections = document.querySelectorAll('.dashboard-section');
            sections.forEach(section => {
                section.classList.remove('active');
            });
            
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
                targetSection.classList.add('animated', 'fadeInUp');
            }
            
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.dataset.section === sectionId) {
                    link.classList.add('active');
                }
            });
            
            const sidebarBtns = document.querySelectorAll('.sidebar-btn');
            sidebarBtns.forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.section === sectionId) {
                    btn.classList.add('active');
                }
            });
            
            if (window.innerWidth <= 992) {
                document.getElementById('hamburger').classList.remove('active');
                document.querySelector('.sidebar').classList.remove('active');
            }
        }

        function updateUser(updatedUser) {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const index = users.findIndex(u => u.username === updatedUser.username);
            if (index !== -1) {
                users[index] = updatedUser;
                localStorage.setItem('users', JSON.stringify(users));
            }
        }

        function initializePendingTasks() {
            const pendingTasksList = document.getElementById('pending-tasks');
            pendingTasksList.innerHTML = '';
            pendingTasks.forEach(task => {
                const taskItem = document.createElement('li');
                taskItem.className = `task-item ${task.read ? '' : 'unread'}`;
                taskItem.dataset.id = task.id;
                taskItem.innerHTML = `<i class="fas fa-bell ${task.read ? 'fa-check-circle' : 'unread'}"></i> ${sanitizeInput(task.text)}`;
                pendingTasksList.appendChild(taskItem);
            });
            
            // Add event listeners to task items
            document.querySelectorAll('.task-item').forEach(item => {
                item.addEventListener('click', function() {
                    const taskId = parseInt(this.dataset.id);
                    const task = pendingTasks.find(t => t.id === taskId);
                    if (task && !task.read) {
                        task.read = true;
                        this.classList.remove('unread');
                        this.querySelector('i').className = 'fas fa-check-circle';
                        showToast('Task marked as read');
                    }
                });
            });
        }
        
        function initializeParentsList() {
            const parentsList = document.getElementById('parents-list');
            parentsList.innerHTML = '';
            parentsData.forEach(parent => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${sanitizeInput(parent.parent)}</td>
                    <td>${sanitizeInput(parent.student)}</td>
                    <td>${sanitizeInput(parent.relationship)}</td>
                    <td><a href="tel:${parent.phone}" class="phone-link">${sanitizeInput(parent.phone)}</a></td>
                    <td><a href="mailto:${parent.email}" class="email-link">${sanitizeInput(parent.email)}</a></td>
                    <td>
                        <button class="communication-btn" data-email="${parent.email}" data-phone="${parent.phone}">
                            <i class="fas fa-envelope"></i> Message
                        </button>
                    </td>
                `;
                parentsList.appendChild(row);
            });
            
            // Add event listeners to communication buttons
            document.querySelectorAll('.communication-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const email = this.dataset.email;
                    const phone = this.dataset.phone;
                    
                    document.getElementById('comms-email').value = email;
                    document.getElementById('comms-phone').value = phone;
                    document.getElementById('message-subject').value = '';
                    document.getElementById('message-content').value = '';
                    
                    openModal(document.getElementById('communication-modal'));
                });
            });
        }
        
        function generateReport(studentName) {
            const subjects = ["Mathematics", "English", "Science", "Cinyanja", "History", "Art", "Music", "PE"];
            
            let reportHTML = `
                <div class="report-content">
                    <div class="report-header">
                        <h3>AGAPE ACADEMY</h3>
                        <p>End of Term Report - Term 2, 2025</p>
                    </div>
                    
                    <div class="report-section">
                        <div class="grid-2col">
                            <div>
                                <p><strong>Student:</strong> ${sanitizeInput(studentName)}</p>
                                <p><strong>Class:</strong> Grade 3</p>
                                <p><strong>Teacher:</strong> Mr. Phiri</p>
                            </div>
                            <div>
                                <p><strong>Term:</strong> 2</p>
                                <p><strong>Year:</strong> 2025</p>
                                <p><strong>Date:</strong> ${new Date().toLocaleDateString()}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="report-section">
                        <h4>Academic Performance</h4>
                        <table class="grade-table">
                            <thead>
                                <tr>
                                    <th>Subject</th>
                                    <th>Test 1</th>
                                    <th>Test 2</th>
                                    <th>Average</th>
                                    <th>Position in Subject</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            subjects.forEach(subject => {
                const test1 = Math.floor(Math.random() * 20) + 70;
                const test2 = Math.floor(Math.random() * 20) + 70;
                const average = Math.round((test1 + test2) / 2);
                const position = Math.floor(Math.random() * 40) + 1;
                
                reportHTML += `
                    <tr>
                        <td>${subject}</td>
                        <td>${test1}%</td>
                        <td>${test2}%</td>
                        <td>${average}%</td>
                        <td>${position}</td>
                    </tr>
                `;
            });
            
            const classPosition = Math.floor(Math.random() * 40) + 1;
            
            reportHTML += `
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="report-section">
                        <div class="grid-2col">
                            <div>
                                <h4>Overall Position in Class</h4>
                                <p>${classPosition} out of 40 students</p>
                            </div>
                            <div>
                                <h4>Attendance</h4>
                                <p>95% (Excellent)</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="report-section">
                        <h4>Teacher's Comments</h4>
                        <p>${studentName} has shown excellent progress this term. They have demonstrated a strong understanding of mathematical concepts and have improved their reading comprehension skills. ${studentName} participates actively in class discussions and collaborates well with peers. With continued effort, they will excel even further next term.</p>
                        <p class="mt-2"><strong>Signature:</strong> _________________________</p>
                    </div>
                    
                    <div class="report-section">
                        <h4>Head Teacher's Remarks</h4>
                        <p>This report reflects consistent effort and achievement. Keep up the good work!</p>
                        <p class="mt-2"><strong>Signature:</strong> _________________________</p>
                    </div>
                </div>
            `;
            
            return reportHTML;
        }
        
        function downloadSingleReport(studentName) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(18);
            doc.text("AGAPE ACADEMY", 105, 20, null, null, 'center');
            doc.setFontSize(14);
            doc.text("Academic Report - Term 2, 2025", 105, 28, null, null, 'center');
            
            doc.setFontSize(12);
            doc.text(`Student: ${studentName}`, 20, 45);
            doc.text("Class: Grade 3", 20, 55);
            doc.text("Teacher: Mr. Phiri", 20, 65);
            doc.text(`Date: ${new Date().toLocaleDateString()}`, 140, 65);
            
            let y = 85;
            
            doc.setFillColor(0, 102, 0);
            doc.setTextColor(255, 255, 255);
            doc.rect(20, y, 170, 10, 'F');
            doc.text("Subject", 30, y+7);
            doc.text("Test 1", 90, y+7);
            doc.text("Test 2", 120, y+7);
            doc.text("Average", 150, y+7);
            doc.text("Position", 170, y+7);
            y += 10;
            
            doc.setTextColor(0, 0, 0);
            
            const subjects = ["Mathematics", "English", "Science", "Cinyanja", "History", "Art", "Music", "PE"];
            subjects.forEach(subject => {
                doc.rect(20, y, 170, 10);
                doc.text(subject, 25, y+7);
                
                const test1 = Math.floor(Math.random() * 20) + 70;
                const test2 = Math.floor(Math.random() * 20) + 70;
                const average = Math.round((test1 + test2) / 2);
                const position = Math.floor(Math.random() * 40) + 1;
                
                doc.text(`${test1}%`, 95, y+7);
                doc.text(`${test2}%`, 125, y+7);
                doc.text(`${average}%`, 155, y+7);
                doc.text(`${position}`, 175, y+7);
                
                y += 10;
            });
            
            const classPosition = Math.floor(Math.random() * 40) + 1;
            y += 5;
            doc.text(`Overall Position in Class: ${classPosition} out of 40 students`, 20, y);
            y += 10;
            doc.text("Attendance: 95% (Excellent)", 20, y);
            
            y += 15;
            doc.setFont(undefined, 'bold');
            doc.text("Teacher's Comments:", 20, y);
            doc.setFont(undefined, 'normal');
            y += 7;
            doc.text(`${studentName} has shown excellent progress this term. They have demonstrated`, 20, y);
            y += 7;
            doc.text(`a strong understanding of mathematical concepts and have improved their`, 20, y);
            y += 7;
            doc.text(`reading comprehension skills. ${studentName} participates actively in class`, 20, y);
            y += 7;
            doc.text(`discussions and collaborates well with peers. With continued effort, they`, 20, y);
            y += 7;
            doc.text(`will excel even further next term.`, 20, y);
            
            y += 15;
            doc.text("Signature: ___________________", 140, y);
            
            doc.save(`Report_${studentName.replace(/\s+/g, '_')}.pdf`);
            showToast(`Report downloaded for ${studentName}`);
        }
        
        function initializeGradebook() {
            const gradebookBody = document.getElementById('gradebook-body');
            gradebookBody.innerHTML = '';
            
            zambianNames.forEach(name => {
                const grades = Array.from({length: 8}, () => Math.floor(Math.random() * 20) + 70);
                const average = (grades.reduce((a, b) => a + b, 0) / grades.length).toFixed(1);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="student-name">
                        <div class="student-name-container">${name}</div>
                        <div class="student-download">
                            <button class="btn btn-outline download-report-btn" data-name="${name}">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    </td>
                    ${grades.map(grade => `<td><input type="number" value="${grade}"></td>`).join('')}
                    <td><strong>${average}%</strong></td>
                `;
                gradebookBody.appendChild(row);
            });
            
            // Add event listeners to download buttons
            document.querySelectorAll('.download-report-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const studentName = this.dataset.name;
                    downloadSingleReport(studentName);
                });
            });
        }
        
        function updateSuggestedTopics(subject) {
            const topicsContainer = document.getElementById('suggested-topics');
            topicsContainer.innerHTML = '';
            
            const topics = subjectTopics[subject] || [];
            topics.forEach(topic => {
                const topicCard = document.createElement('div');
                topicCard.className = 'topic-card';
                topicCard.dataset.topic = topic;
                topicCard.textContent = topic;
                topicCard.addEventListener('click', function() {
                    document.getElementById('lesson-topic').value = topic;
                    document.querySelectorAll('.topic-card').forEach(card => {
                        card.classList.remove('active');
                    });
                    this.classList.add('active');
                });
                topicsContainer.appendChild(topicCard);
            });
        }
        
        function updateAttendanceSummary() {
            const attendanceList = document.getElementById('attendance-list');
            const presentCount = attendanceList.querySelectorAll('.toggle-btn.active:not(.absent):not(.late)').length;
            const absentCount = attendanceList.querySelectorAll('.toggle-btn.absent.active').length;
            const lateCount = attendanceList.querySelectorAll('.toggle-btn.late.active').length;
            const totalCount = presentCount + absentCount + lateCount;
            
            document.getElementById('present-count').textContent = presentCount;
            document.getElementById('absent-count').textContent = absentCount;
            document.getElementById('late-count').textContent = lateCount;
            document.getElementById('total-count').textContent = totalCount;
        }
        
        // Function to enter edit mode for timetable
        function enterTimetableEditMode() {
            const timetable = document.getElementById('timetable-grid');
            const cells = timetable.querySelectorAll('.timetable-cell:not(.timetable-header):not(.empty)');
            
            cells.forEach(cell => {
                cell.classList.add('editing');
                cell.style.cursor = 'pointer';
                
                // Add delete button if not already there
                if (!cell.querySelector('.delete-cell')) {
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'delete-cell';
                    deleteBtn.innerHTML = '<i class="fas fa-times"></i>';
                    deleteBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        cell.innerHTML = '';
                        cell.classList.add('empty');
                        showToast('Timetable entry deleted');
                    });
                    cell.appendChild(deleteBtn);
                }
            });
            
            isTimetableEditing = true;
            document.getElementById('edit-timetable').innerHTML = '<i class="fas fa-times"></i> Cancel Edit';
            document.getElementById('edit-timetable').classList.remove('btn-edit');
            document.getElementById('edit-timetable').classList.add('btn-danger');
            
            // Add click handler to cells
            timetable.querySelectorAll('.timetable-cell').forEach(cell => {
                if (!cell.classList.contains('timetable-header')) {
                    cell.addEventListener('click', function() {
                        if (isTimetableEditing) {
                            selectedCell = this;
                            openModal(document.getElementById('edit-timetable-modal'));
                        }
                    });
                }
            });
        }
        
        // Function to exit edit mode and save the timetable
        function exitTimetableEditMode() {
            const timetable = document.getElementById('timetable-grid');
            const cells = timetable.querySelectorAll('.timetable-cell');
            
            cells.forEach(cell => {
                cell.classList.remove('editing');
                cell.style.cursor = 'default';
                
                const deleteBtn = cell.querySelector('.delete-cell');
                if (deleteBtn) {
                    deleteBtn.remove();
                }
            });
            
            isTimetableEditing = false;
            document.getElementById('edit-timetable').innerHTML = '<i class="fas fa-edit"></i> Edit';
            document.getElementById('edit-timetable').classList.remove('btn-danger');
            document.getElementById('edit-timetable').classList.add('btn-edit');
        }

        function initializeApp() {
            if (!currentUser) return;
            
            // Set user information
            document.querySelector('.teacher-info .name').textContent = currentUser.fullName;
            document.getElementById('full-name').value = currentUser.fullName;
            document.getElementById('email').value = currentUser.email;
            
            // Set avatar if exists
            if (currentUser.avatar) {
                document.getElementById('user-avatar').style.backgroundImage = `url(${currentUser.avatar})`;
                document.getElementById('user-avatar').innerHTML = '';
                document.getElementById('profile-avatar').style.backgroundImage = `url(${currentUser.avatar})`;
                document.getElementById('profile-avatar').innerHTML = '';
            }
            
            // Initialize components
            switchSection('dashboard');
            initializePendingTasks();
            initializeParentsList();
            initializeGradebook();
            updateSuggestedTopics('math');
            updateAttendanceSummary();
            
            // Now that the app is visible, set up event listeners
            setupEventListeners();
        }

        function setupEventListeners() {
            // Navigation functionality
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    switchSection(link.dataset.section);
                });
            });

            // Add event listeners to sidebar buttons
            const sidebarBtns = document.querySelectorAll('.sidebar-btn');
            sidebarBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    switchSection(btn.dataset.section);
                });
            });

            // Toggle sidebar on mobile
            const hamburger = document.getElementById('hamburger');
            const sidebar = document.querySelector('.sidebar');
            hamburger.addEventListener('click', () => {
                hamburger.classList.toggle('active');
                sidebar.classList.toggle('active');
            });

            // Theme toggle
            const themeToggle = document.getElementById('theme-toggle');
            themeToggle.addEventListener('click', () => {
                document.documentElement.classList.toggle('theme-dark');
                localStorage.setItem('theme', document.documentElement.classList.contains('theme-dark') ? 'dark' : 'light');
            });

            // Update topics when subject changes
            document.getElementById('lesson-subject').addEventListener('change', function() {
                updateSuggestedTopics(this.value);
            });
            
            // Modal functionality
            function openModal(modal) {
                modal.style.display = 'flex';
            }
            
            function closeModal(modal) {
                modal.style.display = 'none';
            }
            
            document.querySelectorAll('.close-modal').forEach(button => {
                button.addEventListener('click', function() {
                    closeModal(this.closest('.modal'));
                });
            });
            
            window.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    closeModal(e.target);
                }
            });
            
            // Schedule editing
            document.getElementById('edit-schedule').addEventListener('click', function() {
                openModal(document.getElementById('schedule-modal'));
            });
            
            // Profile editing
            document.getElementById('profile-btn').addEventListener('click', function() {
                openModal(document.getElementById('profile-modal'));
            });
            
            // Save profile
            document.getElementById('save-profile').addEventListener('click', function() {
                currentUser.fullName = document.getElementById('full-name').value;
                currentUser.email = document.getElementById('email').value;
                currentUser.phone = document.getElementById('phone').value;
                currentUser.subjects = document.getElementById('subjects').value;
                currentUser.grades = document.getElementById('grades').value;
                currentUser.bio = document.getElementById('bio').value;
                
                document.querySelector('.teacher-info .name').textContent = currentUser.fullName;
                
                updateUser(currentUser);
                
                showToast('Profile updated successfully!');
                closeModal(document.getElementById('profile-modal'));
            });
            
            // Save schedule
            document.getElementById('save-schedule').addEventListener('click', function() {
                showToast('Schedule updated successfully!');
                closeModal(document.getElementById('schedule-modal'));
            });
            
            // Schedule item selection
            document.querySelectorAll('.schedule-item').forEach(item => {
                item.addEventListener('click', function() {
                    document.querySelectorAll('.schedule-item').forEach(i => {
                        i.classList.remove('selected');
                    });
                    this.classList.add('selected');
                });
            });
            
            // Add schedule item
            document.getElementById('add-schedule-item').addEventListener('click', function() {
                const className = document.getElementById('class-name').value;
                const classDetails = document.getElementById('class-details').value;
                const selectedTime = document.querySelector('.schedule-item.selected')?.dataset.time;
                
                if (!selectedTime || !className) {
                    showToast('Please select a time and enter class name', 'warning');
                    return;
                }
                
                const scheduleList = document.getElementById('daily-schedule');
                const newItem = document.createElement('li');
                newItem.innerHTML = `<i class="fas fa-bell unread"></i> <strong>${sanitizeInput(className)}</strong> - ${selectedTime}`;
                scheduleList.appendChild(newItem);
                
                showToast('Schedule item added');
            });
            
            // Lesson Planner functionality
            document.getElementById('generate-lesson-btn').addEventListener('click', function() {
                const subject = document.getElementById('lesson-subject').value;
                const grade = document.getElementById('lesson-grade').value;
                const topic = sanitizeInput(document.getElementById('lesson-topic').value) || "Fractions";
                const duration = document.getElementById('lesson-duration').value;
                const objectives = sanitizeInput(document.getElementById('lesson-objectives').value) || "Students will be able to identify fractions, compare fractions with like denominators, and represent fractions using visual models.";
                const materials = sanitizeInput(document.getElementById('lesson-materials').value) || "Fraction circles, fraction bars, worksheets, whiteboards, markers";
                
                const intro = zambianLessonComponents.introduction[Math.floor(Math.random() * zambianLessonComponents.introduction.length)];
                const activity = zambianLessonComponents.activity[Math.floor(Math.random() * zambianLessonComponents.activity.length)];
                const assessment = zambianLessonComponents.assessment[Math.floor(Math.random() * zambianLessonComponents.assessment.length)];
                const homework = zambianLessonComponents.homework[Math.floor(Math.random() * zambianLessonComponents.homework.length)];
                
                const lessonContent = `
                    <div class="lesson-content">
                        <div class="lesson-header">
                            <h3>${topic} Lesson Plan</h3>
                            <p>Grade ${grade} | ${subject.charAt(0).toUpperCase() + subject.slice(1)} | Duration: ${duration} minutes</p>
                        </div>
                        
                        <div class="lesson-section">
                            <h4><i class="fas fa-bullseye"></i> Learning Objectives</h4>
                            <p>${objectives}</p>
                        </div>
                        
                        <div class="lesson-section">
                            <h4><i class="fas fa-tools"></i> Materials Needed</h4>
                            <p>${materials}</p>
                        </div>
                        
                        <div class="lesson-section">
                            <h4><i class="fas fa-sign-in-alt"></i> Introduction (Zambian Context)</h4>
                            <p>${intro}</p>
                        </div>
                        
                        <div class="lesson-section">
                            <h4><i class="fas fa-list-ol"></i> Lesson Activities</h4>
                            <ol>
                                <li>Introduction to topic using Zambian context examples</li>
                                <li>${activity}</li>
                                <li>Group discussion on topic relevance to Zambia</li>
                                <li>Practical application exercise</li>
                                <li>Summary and review</li>
                            </ol>
                        </div>
                        
                        <div class="lesson-section">
                            <h4><i class="fas fa-clipboard-check"></i> Assessment</h4>
                            <p>${assessment}</p>
                        </div>
                        
                        <div class="lesson-section">
                            <h4><i class="fas fa-sticky-note"></i> Notes</h4>
                            <p>Differentiation: Provide additional support for struggling students and extension activities for advanced learners.</p>
                            <p>Homework: ${homework}</p>
                        </div>
                        
                        <div class="lesson-section">
                            <h4><i class="fas fa-stamp"></i> Zambian Ministry of Education Standards</h4>
                            <p>This lesson aligns with the Zambian curriculum standards for Grade ${grade} ${subject}:</p>
                            <ul>
                                <li>Standard 3.1: Demonstrate understanding of core concepts</li>
                                <li>Standard 4.2: Apply knowledge to real-world contexts</li>
                                <li>Standard 5.3: Develop critical thinking skills</li>
                            </ul>
                        </div>
                    </div>
                `;
                
                document.getElementById('lesson-preview-content').innerHTML = lessonContent;
                showToast('Lesson plan generated with Zambian context!');
            });

            // AI Enhance lesson button
            document.getElementById('ai-enhance-btn').addEventListener('click', function() {
                const subject = document.getElementById('lesson-subject').value;
                const topic = document.getElementById('lesson-topic').value || "Fractions";
                
                const enhancements = [
                    `Added Zambian context examples for ${topic} to make the lesson more relatable`,
                    `Incorporated hands-on activities using locally available materials`,
                    `Included differentiation strategies for diverse learners`,
                    `Added group collaboration activities for peer learning`,
                    `Integrated technology resources for interactive learning`,
                    `Enhanced assessment methods with formative checks throughout the lesson`
                ];
                
                const randomEnhancement = enhancements[Math.floor(Math.random() * enhancements.length)];
                showToast(`AI Enhancement Applied: ${randomEnhancement}`);
            });

            // Print lesson plan
            document.getElementById('print-lesson').addEventListener('click', function() {
                const printContent = document.getElementById('lesson-preview-content').innerHTML;
                const originalContent = document.body.innerHTML;
                
                document.body.innerHTML = printContent;
                window.print();
                document.body.innerHTML = originalContent;
                showToast('Printing lesson plan...');
            });

            // Download lesson as PDF
            document.getElementById('download-lesson').addEventListener('click', function() {
                const lessonContent = document.getElementById('lesson-preview-content');
                showToast('Generating PDF...');
                
                setTimeout(() => {
                    html2canvas(lessonContent).then(canvas => {
                        const imgData = canvas.toDataURL('image/png');
                        const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
                        const imgProps = pdf.getImageProperties(imgData);
                        const pdfWidth = pdf.internal.pageSize.getWidth();
                        const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
                        
                        pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                        pdf.save('lesson-plan.pdf');
                        showToast('Lesson plan downloaded as PDF');
                    }).catch(error => {
                        showToast('Error generating PDF: ' + error.message, 'error');
                    });
                }, 500);
            });

            // Save lesson plan
            document.getElementById('save-lesson').addEventListener('click', function() {
                const lessonData = {
                    subject: document.getElementById('lesson-subject').value,
                    grade: document.getElementById('lesson-grade').value,
                    topic: document.getElementById('lesson-topic').value,
                    duration: document.getElementById('lesson-duration').value,
                    objectives: document.getElementById('lesson-objectives').value,
                    materials: document.getElementById('lesson-materials').value
                };
                
                localStorage.setItem('lessonPlan', JSON.stringify(lessonData));
                showToast('Lesson plan saved successfully!');
            });

            // Share lesson plan
            document.getElementById('share-lesson').addEventListener('click', function() {
                const lessonContent = document.getElementById('lesson-preview-content').innerText;
                navigator.clipboard.writeText(lessonContent)
                    .then(() => showToast('Lesson content copied to clipboard!'))
                    .catch(err => showToast('Failed to copy: ' + err, 'error'));
            });

            // Load template
            document.querySelectorAll('[data-template]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const template = this.dataset.template;
                    
                    if (template === 'fractions') {
                        document.getElementById('lesson-subject').value = 'math';
                        document.getElementById('lesson-topic').value = 'Fractions';
                        document.getElementById('lesson-objectives').value = 'Students will understand fractions, compare fractions, and solve simple fraction problems using Zambian examples.';
                        document.getElementById('lesson-materials').value = 'Fraction circles, worksheets with Zambian context, whiteboards, markers';
                        showToast('Fractions template loaded');
                    } else if (template === 'greetings') {
                        document.getElementById('lesson-subject').value = 'cinyanja';
                        document.getElementById('lesson-topic').value = 'Greetings';
                        document.getElementById('lesson-objectives').value = 'Students will learn basic greetings in Cinyanja and cultural context.';
                        document.getElementById('lesson-materials').value = 'Flashcards, cultural artifacts, role-play scenarios';
                        showToast('Greetings template loaded');
                    } else if (template === 'ecosystems') {
                        document.getElementById('lesson-subject').value = 'science';
                        document.getElementById('lesson-topic').value = 'Ecosystems';
                        document.getElementById('lesson-objectives').value = 'Students will identify different Zambian ecosystems and their characteristics.';
                        document.getElementById('lesson-materials').value = 'Pictures of Zambian ecosystems, maps, plant samples';
                        showToast('Ecosystems template loaded');
                    }
                });
            });

            // Save template
            document.getElementById('save-template-btn').addEventListener('click', function() {
                const templateName = prompt("Enter a name for this template:");
                if (templateName) {
                    showToast(`Template "${templateName}" saved successfully!`);
                }
            });

            // Attendance Tracker functionality
            // Save attendance
            document.getElementById('save-attendance').addEventListener('click', function() {
                const attendanceData = [];
                document.querySelectorAll('.student-item').forEach(item => {
                    const name = item.querySelector('div:first-child').textContent;
                    const status = item.querySelector('.toggle-btn.active').textContent;
                    attendanceData.push({ name, status });
                });
                
                localStorage.setItem('attendance', JSON.stringify(attendanceData));
                showToast('Attendance saved successfully!');
            });

            // Add student
            document.getElementById('add-student').addEventListener('click', function() {
                const studentName = prompt("Enter student's full name:");
                if (studentName) {
                    const attendanceList = document.getElementById('attendance-list');
                    const newStudent = document.createElement('div');
                    newStudent.className = 'student-item';
                    newStudent.innerHTML = `
                        <div>${sanitizeInput(studentName)}</div>
                        <div class="attendance-toggle">
                            <button class="toggle-btn active">Present</button>
                            <button class="toggle-btn absent">Absent</button>
                            <button class="toggle-btn late">Late</button>
                        </div>
                    `;
                    attendanceList.appendChild(newStudent);
                    
                    // Add event listeners to new buttons
                    addToggleListeners(newStudent);
                    updateAttendanceSummary();
                    showToast(`Student ${studentName} added`);
                }
            });

            // Add toggle button functionality
            function addToggleListeners(container) {
                const toggleBtns = container.querySelectorAll('.toggle-btn');
                toggleBtns.forEach(btn => {
                    btn.addEventListener('click', function() {
                        const parent = this.parentElement;
                        parent.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                        updateAttendanceSummary();
                    });
                });
            }

            // Initialize toggle buttons
            document.querySelectorAll('.attendance-toggle').forEach(container => {
                addToggleListeners(container);
            });

            // Gradebook functionality
            // Save grades
            document.getElementById('save-grades').addEventListener('click', function() {
                showToast('Grades saved successfully!');
            });

            // Add student
            document.getElementById('add-student-grade').addEventListener('click', function() {
                const studentName = prompt("Enter student's full name:");
                if (studentName) {
                    const gradebookBody = document.getElementById('gradebook-body');
                    const grades = Array.from({length: 8}, () => 0);
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="student-name">
                            <div class="student-name-container">${sanitizeInput(studentName)}</div>
                            <div class="student-download">
                                <button class="btn btn-outline download-report-btn" data-name="${sanitizeInput(studentName)}">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </td>
                        ${grades.map(grade => `<td><input type="number" value="${grade}"></td>`).join('')}
                        <td><strong>0.0%</strong></td>
                    `;
                    gradebookBody.appendChild(row);
                    
                    // Add event listener to the new download button
                    row.querySelector('.download-report-btn').addEventListener('click', function() {
                        downloadSingleReport(studentName);
                    });
                    
                    showToast(`Student ${studentName} added to gradebook`);
                }
            });

            // Delete student
            document.getElementById('delete-student').addEventListener('click', function() {
                const selected = document.querySelector('#gradebook-body tr.selected');
                if (selected) {
                    const studentName = selected.querySelector('.student-name-container').textContent;
                    selected.remove();
                    showToast(`Student ${studentName} removed`);
                } else {
                    showToast('Please select a student to remove', 'warning');
                }
            });

            // Add selection to gradebook rows
            const gradebookBody = document.getElementById('gradebook-body');
            gradebookBody.addEventListener('click', function(e) {
                if (e.target.closest('tr')) {
                    const row = e.target.closest('tr');
                    document.querySelectorAll('#gradebook-body tr').forEach(r => {
                        r.classList.remove('selected');
                    });
                    row.classList.add('selected');
                }
            });

            // Generate all reports as a zip file
            document.getElementById('generate-reports').addEventListener('click', function() {
                showToast('Generating reports... this may take a moment');
                
                setTimeout(() => {
                    showToast(`Generated ${zambianNames.length} report forms in ZIP file`);
                    // Create a ZIP file download link
                    const link = document.createElement('a');
                    link.href = '#';
                    link.download = 'grade_reports.zip';
                    link.click();
                }, 2000);
            });

            // Test Generator functionality
            document.getElementById('generate-test-btn').addEventListener('click', function() {
                const subject = document.getElementById('test-subject').value;
                const grade = document.getElementById('test-grade').value;
                const topic = sanitizeInput(document.getElementById('test-topic').value) || "General";
                const duration = document.getElementById('test-duration').value;
                const questionCount = parseInt(document.getElementById('question-count').value);
                
                const questions = questionBanks[subject] || questionBanks.math;
                
                const selectedQuestions = [];
                const selectedAnswers = [];
                const shuffled = [...questions].sort(() => 0.5 - Math.random());
                
                for (let i = 0; i < Math.min(questionCount, shuffled.length); i++) {
                    selectedQuestions.push(shuffled[i].q);
                    selectedAnswers.push(shuffled[i].a);
                }
                
                let testContent = `
                    <div class="test-content">
                        <div class="test-header">
                            <h3>${topic} Test</h3>
                            <p>Grade ${grade} | ${subject.charAt(0).toUpperCase() + subject.slice(1)} | Duration: ${duration} minutes</p>
                        </div>
                        
                        <div class="test-section">
                            <h4><i class="fas fa-question-circle"></i> Instructions</h4>
                            <p>Answer all questions. Show your work where necessary.</p>
                        </div>
                        
                        <div class="test-section">
                            <h4><i class="fas fa-pencil-alt"></i> Questions</h4>
                            <ol>
                `;
                
                selectedQuestions.forEach((q, i) => {
                    testContent += `<li>${q}</li>`;
                });
                
                testContent += `
                            </ol>
                        </div>
                        
                        <div class="test-section">
                            <h4><i class="fas fa-key"></i> Answer Key</h4>
                            <ol>
                `;
                
                selectedAnswers.forEach((a, i) => {
                    testContent += `<li>${a}</li>`;
                });
                
                testContent += `
                            </ol>
                        </div>
                    </div>
                `;
                
                document.getElementById('test-preview-content').innerHTML = testContent;
                showToast(`Generated ${selectedQuestions.length} questions on ${topic}`);
            });

            // Print test
            document.getElementById('print-test').addEventListener('click', function() {
                const printContent = document.getElementById('test-preview-content').innerHTML;
                const originalContent = document.body.innerHTML;
                
                document.body.innerHTML = printContent;
                window.print();
                document.body.innerHTML = originalContent;
                showToast('Printing test...');
            });

            // Download test as PDF
            document.getElementById('download-test').addEventListener('click', function() {
                const testContent = document.getElementById('test-preview-content');
                showToast('Generating PDF...');
                
                setTimeout(() => {
                    html2canvas(testContent).then(canvas => {
                        const imgData = canvas.toDataURL('image/png');
                        const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
                        const imgProps = pdf.getImageProperties(imgData);
                        const pdfWidth = pdf.internal.pageSize.getWidth();
                        const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
                        
                        pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                        pdf.save('test.pdf');
                        showToast('Test downloaded as PDF');
                    }).catch(error => {
                        showToast('Error generating PDF: ' + error.message, 'error');
                    });
                }, 500);
            });

            // Save test
            document.getElementById('save-test').addEventListener('click', function() {
                const testData = {
                    subject: document.getElementById('test-subject').value,
                    grade: document.getElementById('test-grade').value,
                    topic: document.getElementById('test-topic').value,
                    duration: document.getElementById('test-duration').value,
                    questionCount: document.getElementById('question-count').value
                };
                
                localStorage.setItem('test', JSON.stringify(testData));
                showToast('Test saved successfully!');
            });
            
            // AI Enhance test
            document.getElementById('ai-enhance-test-btn').addEventListener('click', function() {
                const subject = document.getElementById('test-subject').value;
                const topic = document.getElementById('test-topic').value || "Fractions";
                
                const enhancements = [
                    `Added Zambian context to test questions for ${topic}`,
                    `Incorporated multiple question types (multiple choice, short answer, essay)`,
                    `Added visual elements to support different learning styles`,
                    `Included culturally relevant examples in questions`,
                    `Enhanced questions to assess higher-order thinking skills`
                ];
                
                const randomEnhancement = enhancements[Math.floor(Math.random() * enhancements.length)];
                showToast(`AI Enhancement Applied: ${randomEnhancement}`);
            });
            
            // Mark tasks as read when clicked
            document.querySelectorAll('.card li').forEach(item => {
                item.addEventListener('click', function() {
                    if (this.classList.contains('unread')) {
                        this.classList.remove('unread');
                        this.querySelector('i').className = 'fas fa-check-circle';
                        this.querySelector('i').style.color = 'var(--success)';
                    }
                });
            });
            
            // Dashboard button functionality
            document.getElementById('view-tasks').addEventListener('click', function() {
                const modal = document.getElementById('tasks-modal');
                const list = document.getElementById('all-tasks-list');
                list.innerHTML = '';
                
                pendingTasks.forEach(task => {
                    const item = document.createElement('li');
                    item.className = `task-item ${task.read ? '' : 'unread'}`;
                    item.dataset.id = task.id;
                    item.innerHTML = `<i class="fas fa-bell ${task.read ? 'fa-check-circle' : 'unread'}"></i> ${sanitizeInput(task.text)}`;
                    list.appendChild(item);
                });
                
                openModal(modal);
            });
            
            document.getElementById('view-resources').addEventListener('click', function() {
                const modal = document.getElementById('resources-modal');
                const list = document.getElementById('resources-list');
                list.innerHTML = '';
                
                resources.forEach(resource => {
                    const item = document.createElement('li');
                    item.className = 'resource-item';
                    item.innerHTML = `<i class="fas fa-link"></i> ${resource}`;
                    list.appendChild(item);
                });
                
                openModal(modal);
            });
            
            document.getElementById('view-report').addEventListener('click', function() {
                const modal = document.getElementById('report-modal');
                const content = document.getElementById('report-content');
                
                // Generate a class performance report
                let reportHTML = `
                    <div class="report-header">
                        <h3>AGAPE ACADEMY</h3>
                        <p>Class Performance Report - Grade 3, Term 2 2025</p>
                    </div>
                    
                    <div class="report-section">
                        <h4><i class="fas fa-chart-line"></i> Overall Performance</h4>
                        <p>Mathematics: 87% average</p>
                        <div class="progress-container">
                            <div class="progress-bar" style="width: 87%"></div>
                        </div>
                        
                        <p>English: 92% average</p>
                        <div class="progress-container">
                            <div class="progress-bar" style="width: 92%"></div>
                        </div>
                        
                        <p>Science: 78% average</p>
                        <div class="progress-container">
                            <div class="progress-bar" style="width: 78%"></div>
                        </div>
                    </div>
                    
                    <div class="report-section">
                        <h4><i class="fas fa-star"></i> Top 5 Students</h4>
                        <ol>
                            <li>Sarah Johnson - 98%</li>
                            <li>Michael Brown - 96%</li>
                            <li>Emily Davis - 95%</li>
                            <li>David Banda - 94%</li>
                            <li>Grace Phiri - 93%</li>
                        </ol>
                    </div>
                    
                    <div class="report-section">
                        <h4><i class="fas fa-lightbulb"></i> Recommendations</h4>
                        <p>1. Provide additional support in Science topics</p>
                        <p>2. Implement peer tutoring for struggling students</p>
                        <p>3. Incorporate more hands-on activities in Mathematics</p>
                    </div>
                `;
                
                content.innerHTML = reportHTML;
                openModal(modal);
            });
            
            // Parents section functionality
            document.getElementById('add-parent').addEventListener('click', function() {
                openModal(document.getElementById('add-parent-modal'));
            });
            
            document.getElementById('add-parent-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const newParent = {
                    parent: document.getElementById('parent-name').value,
                    student: document.getElementById('student-name').value,
                    relationship: document.getElementById('relationship').value,
                    phone: document.getElementById('parent-phone').value,
                    email: document.getElementById('parent-email').value
                };
                
                parentsData.push(newParent);
                initializeParentsList();
                showToast('Parent added successfully!');
                closeModal(document.getElementById('add-parent-modal'));
                this.reset();
            });
            
            // Communication functionality
            document.getElementById('send-email-btn').addEventListener('click', function() {
                const email = document.getElementById('comms-email').value;
                const subject = encodeURIComponent(document.getElementById('message-subject').value);
                const body = encodeURIComponent(document.getElementById('message-content').value);
                
                window.location.href = `mailto:${email}?subject=${subject}&body=${body}`;
                closeModal(document.getElementById('communication-modal'));
            });
            
            document.getElementById('call-parent-btn').addEventListener('click', function() {
                const phone = document.getElementById('comms-phone').value;
                window.location.href = `tel:${phone}`;
                closeModal(document.getElementById('communication-modal'));
            });
            
            // Timetable functionality
            document.getElementById('edit-timetable').addEventListener('click', function() {
                if (isTimetableEditing) {
                    exitTimetableEditMode();
                } else {
                    enterTimetableEditMode();
                }
            });
            
            document.getElementById('save-timetable').addEventListener('click', function() {
                if (isTimetableEditing) {
                    exitTimetableEditMode();
                }
                showToast('Timetable saved successfully!');
            });
            
            document.getElementById('print-timetable').addEventListener('click', function() {
                const printContent = document.getElementById('timetable-grid').outerHTML;
                const originalContent = document.body.innerHTML;
                
                document.body.innerHTML = printContent;
                window.print();
                document.body.innerHTML = originalContent;
                showToast('Printing timetable...');
            });
            
            // Timetable entry editing
            document.getElementById('save-entry-btn').addEventListener('click', function() {
                const day = document.getElementById('timetable-day').value;
                const time = document.getElementById('timetable-time').value;
                const className = document.getElementById('timetable-class').value;
                const location = document.getElementById('timetable-location').value;
                
                if (!className) {
                    showToast('Please enter a class name', 'warning');
                    return;
                }
                
                if (selectedCell) {
                    selectedCell.innerHTML = `
                        <div class="timetable-class">${className}</div>
                        <div class="timetable-class">${location}</div>
                    `;
                    selectedCell.classList.remove('empty');
                    showToast('Timetable entry updated');
                    closeModal(document.getElementById('edit-timetable-modal'));
                }
            });
            
            document.getElementById('delete-entry-btn').addEventListener('click', function() {
                if (selectedCell) {
                    selectedCell.innerHTML = '';
                    selectedCell.classList.add('empty');
                    showToast('Timetable entry deleted');
                    closeModal(document.getElementById('edit-timetable-modal'));
                }
            });
        }

        // Auth form functionality
        showRegister.addEventListener('click', function() {
            loginCard.style.display = 'none';
            registerCard.style.display = 'block';
            authState = 'register';
        });
        
        showLogin.addEventListener('click', function() {
            registerCard.style.display = 'none';
            loginCard.style.display = 'block';
            authState = 'login';
        });
        
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                loginPage.style.display = 'none';
                appContainer.style.display = 'block';
                currentUser = user;
                showToast(`Welcome back, ${user.fullName}!`);
                
                initializeApp();
            } else {
                showToast('Invalid username or password', 'error');
            }
        });
        
        registerForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const fullName = document.getElementById('full-name').value;
            const email = document.getElementById('reg-email').value;
            const username = document.getElementById('reg-username').value;
            const password = document.getElementById('reg-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            if (password !== confirmPassword) {
                showToast('Passwords do not match', 'error');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('users')) || [];
            
            if (users.some(u => u.username === username)) {
                showToast('Username already exists', 'error');
                return;
            }
            
            const newUser = {
                fullName,
                email,
                username,
                password,
                avatar: null
            };
            
            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            
            showToast('Account created successfully! Please login');
            showLogin.click();
            registerForm.reset();
        });
        
        const logoutBtn = document.getElementById('logout-btn');
        logoutBtn.addEventListener('click', function() {
            currentUser = null;
            appContainer.style.display = 'none';
            loginPage.style.display = 'flex';
            loginCard.style.display = 'block';
            registerCard.style.display = 'none';
            showToast('You have been logged out');
        });
        
        const changeAvatarBtn = document.getElementById('change-avatar');
        const avatarUpload = document.getElementById('avatar-upload');
        changeAvatarBtn.addEventListener('click', function() {
            avatarUpload.click();
        });
        
        avatarUpload.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const imageUrl = event.target.result;
                    
                    document.getElementById('user-avatar').style.backgroundImage = `url(${imageUrl})`;
                    document.getElementById('user-avatar').innerHTML = '';
                    document.getElementById('profile-avatar').style.backgroundImage = `url(${imageUrl})`;
                    document.getElementById('profile-avatar').innerHTML = '';
                    
                    if (currentUser) {
                        currentUser.avatar = imageUrl;
                        updateUser(currentUser);
                    }
                    
                    showToast('Profile photo updated');
                };
                reader.readAsDataURL(file);
            }
        });
        
        // Initial setup
        document.addEventListener('DOMContentLoaded', function() {
            if (localStorage.getItem('theme') === 'dark') {
                document.documentElement.classList.add('theme-dark');
            }
        });
    </script>
</body>
</html>
